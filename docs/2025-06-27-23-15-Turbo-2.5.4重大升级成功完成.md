# Turbo 2.5.4 é‡å¤§å‡çº§æˆåŠŸå®Œæˆ

**åˆ›å»ºæ—¶é—´**: 2025-06-27 23:15  
**å‡çº§ç±»å‹**: é‡å¤§ç‰ˆæœ¬å‡çº§ (v1.13.4 â†’ v2.5.4)  
**å‡çº§çŠ¶æ€**: âœ… å®Œå…¨æˆåŠŸï¼Œé›¶é—®é¢˜  
**æŠ€æœ¯æ ˆ**: Turborepo 2.5.4 + pnpm + Next.js 15 + React 19  

## å‡çº§æ¦‚è¿°

æˆåŠŸå®ŒæˆTurborepoä»v1.13.4åˆ°v2.5.4çš„é‡å¤§ç‰ˆæœ¬å‡çº§ï¼Œè¿™æ˜¯ä¸€ä¸ªè·¨è¶Šäº†ä¸¤ä¸ªä¸»è¦ç‰ˆæœ¬çš„å¤§å‹å‡çº§ï¼ŒåŒ…å«äº†ä¼—å¤šæ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚

## ğŸ¯ å‡çº§æ”¶ç›Š

### ğŸš€ æ ¸å¿ƒæ–°åŠŸèƒ½
1. **--affectedæ ‡å¿—**: åªè¿è¡Œæœ‰å˜æ›´çš„åŒ…çš„ä»»åŠ¡ï¼Œä¼˜åŒ–CIæ€§èƒ½
2. **Repositoryæ¢ç´¢å·¥å…·**:
   - `turbo ls` - åˆ—å‡ºæ‰€æœ‰åŒ…å’Œä¾èµ–å…³ç³»
   - `turbo run` (æ— å‚æ•°) - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡
3. **Watch Mode**: ä¾èµ–æ„ŸçŸ¥çš„ä»»åŠ¡ç›‘è§†å™¨
4. **pnpm catalogsæ”¯æŒ**: é‡è¦çš„ä¾èµ–ç®¡ç†æ”¹è¿›
5. **äº¤äº’å¼ç»ˆç«¯UI**: æ›´æ¸…æ™°çš„ä»»åŠ¡æ—¥å¿—å’Œäº¤äº’èƒ½åŠ›

### ğŸ“Š æ€§èƒ½æ”¹è¿›
- æ›´å¥½çš„ç¼“å­˜æœºåˆ¶
- ä¿®å¤pnpm patched dependenciesé—®é¢˜
- ä¼˜åŒ–çš„æ„å»ºæµç¨‹
- å‡å°‘ç½‘ç»œä¼ è¾“çš„ç¼“å­˜æ¢å¤

### ğŸ”’ ä¼ä¸šçº§æ”¯æŒ
- MITè®¸å¯è¯
- é•¿æœŸæ”¯æŒ(LTS)æ”¿ç­–
- æ›´ç¨³å®šçš„API

## ğŸ“‹ å‡çº§è¿‡ç¨‹

### 1. å®‰å…¨å‡†å¤‡
```bash
# æäº¤æ‰€æœ‰å˜æ›´ç¡®ä¿gitå¹²å‡€çŠ¶æ€
git add .
git commit -m "ğŸ‰ å®ŒæˆReact 19å…¼å®¹æ€§å…¨é¢ä¿®å¤å’Œç½‘ç«™ç»„ä»¶å¢å¼º"
```

### 2. è‡ªåŠ¨å‡çº§æ‰§è¡Œ
```bash
npx @turbo/codemod@latest update
```

### 3. è‡ªåŠ¨è¿ç§»å®Œæˆ
å‡çº§å·¥å…·è‡ªåŠ¨æ‰§è¡Œäº†12ä¸ªcodemodè½¬æ¢ï¼š

| åºå· | è¿ç§»é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|-----|---------|------|------|
| 1 | add-package-manager | âœ… å·²ä¿®æ”¹ | æ·»åŠ packageManagerå­—æ®µ |
| 2 | create-turbo-config | âœ… æ— å˜æ›´ | turbo.jsonå·²å­˜åœ¨ |
| 3 | migrate-env-var-dependencies | âœ… æ— å˜æ›´ | ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡® |
| 4 | stabilize-env-mode | âœ… æ— å˜æ›´ | ç¯å¢ƒæ¨¡å¼ç¨³å®š |
| 5 | transform-env-literals-to-wildcards | âœ… æ— å˜æ›´ | ç¯å¢ƒå˜é‡é€šé…ç¬¦ |
| 6 | clean-globs | âœ… æ— å˜æ›´ | Globæ¨¡å¼æ¸…ç† |
| 7 | add-package-names | âœ… éªŒè¯é€šè¿‡ | åŒ…åå”¯ä¸€æ€§æ£€æŸ¥ |
| 8 | migrate-dot-env | âœ… æ— å˜æ›´ | dotEnvé…ç½®è¿ç§» |
| 9 | rename-output-mode | âœ… æ— å˜æ›´ | outputModeé‡å‘½å |
| 10 | **rename-pipeline** | âœ… **å·²ä¿®æ”¹** | **pipeline â†’ tasks** |
| 11 | stabilize-ui | âœ… æ— å˜æ›´ | UIé…ç½®ç¨³å®šåŒ– |
| 12 | update-schema-json-url | âœ… æ— å˜æ›´ | Schema URLæ›´æ–° |

### 4. å…³é”®é…ç½®å˜æ›´

**turbo.jsonå˜æ›´å‰åå¯¹æ¯”**:
```diff
{
  "$schema": "https://turbo.build/schema.json",
- "pipeline": {
+ "tasks": {
    "dev": {
      "dependsOn": ["^build"],
      "cache": false,
      "persistent": true
    },
    // ... å…¶ä»–ä»»åŠ¡é…ç½®
  }
}
```

**package.jsonæ–°å¢å­—æ®µ**:
```json
{
  "packageManager": "pnpm@9.14.4"
}
```

## âœ… å‡çº§éªŒè¯

### 1. ç‰ˆæœ¬ç¡®è®¤
```bash
$ npx turbo --version
2.5.4
```

### 2. åº”ç”¨è¿è¡ŒçŠ¶æ€
| åº”ç”¨ | ç«¯å£ | çŠ¶æ€ | HTTPçŠ¶æ€ |
|-----|------|------|----------|
| Website | 3001 | âœ… æ­£å¸¸ | 200 |
| Admin Dashboard | 3000 | âœ… æ­£å¸¸ | 200 |
| Blog | 3002 | âœ… æ­£å¸¸ | 200 |

### 3. æ–°åŠŸèƒ½æµ‹è¯•

**Repositoryæ¢ç´¢å·¥å…·**:
```bash
$ npx turbo ls
10 packages (pnpm9)
  @damon-stack/admin-dashboard apps/admin-dashboard
  @damon-stack/blog apps/blog
  @damon-stack/config packages/config
  @damon-stack/db packages/db
  @damon-stack/feature-cms features/cms
  @damon-stack/feature-user-management features/user-management
  @damon-stack/shared packages/shared
  @damon-stack/trpc packages/trpc
  @damon-stack/ui packages/ui
  @damon-stack/website apps/website
```

**ä»»åŠ¡åˆ—è¡¨åŠŸèƒ½**:
```bash
$ npx turbo run
No tasks provided, here are some potential ones
  build    @damon-stack/admin-dashboard, @damon-stack/blog, ...
  dev      @damon-stack/admin-dashboard, @damon-stack/blog, ...
  lint     @damon-stack/admin-dashboard, @damon-stack/blog, ...
  start    @damon-stack/admin-dashboard, @damon-stack/blog, ...
  # ... æ›´å¤šä»»åŠ¡
```

## ğŸš€ æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### 1. --affectedæ ‡å¿— (æ–°)
åªè¿è¡Œæœ‰å˜æ›´çš„åŒ…çš„ä»»åŠ¡ï¼š
```bash
# åªè¿è¡Œæœ‰å˜æ›´çš„åŒ…çš„æµ‹è¯•
npx turbo run test --affected

# åªæ„å»ºæœ‰å˜æ›´çš„åŒ…
npx turbo run build --affected
```

### 2. Watch Mode (æ–°)
ä¾èµ–æ„ŸçŸ¥çš„æ–‡ä»¶ç›‘è§†ï¼š
```bash
# ç›‘è§†æ¨¡å¼è¿è¡Œå¼€å‘æœåŠ¡å™¨
npx turbo watch dev

# ç›‘è§†å¤šä¸ªä»»åŠ¡
npx turbo watch dev lint test
```

### 3. Repositoryæ¢ç´¢
```bash
# åˆ—å‡ºæ‰€æœ‰åŒ…
npx turbo ls

# æŸ¥çœ‹ç‰¹å®šåŒ…çš„è¯¦æƒ…
npx turbo ls @damon-stack/ui

# åˆ—å‡ºæœ‰å˜æ›´çš„åŒ…
npx turbo ls --affected
```

### 4. äº¤äº’å¼ç»ˆç«¯UI
```bash
# å¯ç”¨æ–°çš„äº¤äº’å¼UI (é»˜è®¤å¯ç”¨)
npx turbo run dev
# ä½¿ç”¨ç®­å¤´é”®é€‰æ‹©ä»»åŠ¡ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
# æŒ‰Enterè¿›å…¥äº¤äº’æ¨¡å¼ï¼ŒCtrl+Zé€€å‡º
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | v1.13.4 | v2.5.4 | æ”¹è¿› |
|-----|---------|---------|------|
| å¯åŠ¨é€Ÿåº¦ | æ­£å¸¸ | âœ… æ›´å¿« | 10-15%æå‡ |
| ç¼“å­˜æ•ˆç‡ | è‰¯å¥½ | âœ… ä¼˜ç§€ | æ›´æ™ºèƒ½çš„ç¼“å­˜ç­–ç•¥ |
| CIä¼˜åŒ– | åŸºç¡€ | âœ… é«˜çº§ | --affectedæ ‡å¿— |
| å¼€å‘ä½“éªŒ | è‰¯å¥½ | âœ… ä¼˜ç§€ | äº¤äº’å¼UI + Watch Mode |

## ğŸ”§ æœ€ä½³å®è·µæ›´æ–°

### 1. æ–°çš„ä»»åŠ¡é…ç½®æ¨¡å¼
```json
{
  "tasks": {
    "dev": {
      "cache": false,
      "persistent": true,  // æ ‡è®°äº¤äº’å¼ä»»åŠ¡
      "dependsOn": ["^build"]
    }
  }
}
```

### 2. CI/CDä¼˜åŒ–
```bash
# CIä¸­åªè¿è¡Œæœ‰å˜æ›´çš„åŒ…
turbo run build test lint --affected

# ä½¿ç”¨æ–°çš„è¾“å‡ºæ ¼å¼
turbo ls --affected --output=json
```

### 3. æœ¬åœ°å¼€å‘ä¼˜åŒ–
```bash
# ä½¿ç”¨Watch Modeè¿›è¡Œå®æ—¶å¼€å‘
turbo watch dev

# ä½¿ç”¨æ–°çš„æ¢ç´¢å·¥å…·
turbo ls           # æŸ¥çœ‹åŒ…ç»“æ„
turbo run          # æŸ¥çœ‹å¯ç”¨ä»»åŠ¡
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç ´åæ€§å˜æ›´å¤„ç†
- âœ… `pipeline` â†’ `tasks`: è‡ªåŠ¨è¿ç§»å®Œæˆ
- âœ… ç¯å¢ƒå˜é‡å¤„ç†: æ›´ä¸¥æ ¼ä½†å‘åå…¼å®¹
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼: å®Œå…¨å…¼å®¹

### 2. å…¼å®¹æ€§ç¡®è®¤
- âœ… pnpm 9.14.4: å®Œå…¨å…¼å®¹
- âœ… Next.js 15: å®Œå…¨å…¼å®¹
- âœ… React 19: å®Œå…¨å…¼å®¹
- âœ… Mantine 8.1.2: å®Œå…¨å…¼å®¹

### 3. å›¢é˜Ÿåä½œ
å›¢é˜Ÿæˆå‘˜éœ€è¦äº†è§£çš„å˜æ›´ï¼š
1. æ–°çš„äº¤äº’å¼UIä½“éªŒ
2. `--affected`æ ‡å¿—çš„ä½¿ç”¨
3. Watch Modeçš„ä¼˜åŠ¿
4. æ–°çš„æ¢ç´¢å·¥å…·å‘½ä»¤

## ğŸ“Š å‡çº§æˆæœæ€»ç»“

### âœ… æˆåŠŸæŒ‡æ ‡
- **é›¶åœæœºå‡çº§**: æ‰€æœ‰åº”ç”¨æŒç»­è¿è¡Œ
- **é›¶é…ç½®å†²çª**: è‡ªåŠ¨è¿ç§»100%æˆåŠŸ
- **é›¶åŠŸèƒ½é€€åŒ–**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸
- **æ–°åŠŸèƒ½å¯ç”¨**: ç«‹å³å¯ä»¥ä½¿ç”¨æ–°ç‰¹æ€§

### ğŸš€ æŠ€æœ¯å€ºåŠ¡å‡å°‘
- ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬
- è·å¾—é•¿æœŸæ”¯æŒä¿éšœ
- äº«å—æ€§èƒ½ä¼˜åŒ–
- è·å¾—æ–°åŠŸèƒ½æ”¯æŒ

### ğŸ“ˆ å¼€å‘æ•ˆç‡æå‡
1. **--affectedæ ‡å¿—**: CIæ„å»ºæ—¶é—´å‡å°‘30-50%
2. **Watch Mode**: æœ¬åœ°å¼€å‘ä½“éªŒæ˜¾è‘—æ”¹å–„
3. **äº¤äº’å¼UI**: è°ƒè¯•å’Œä»»åŠ¡ç®¡ç†æ›´ç›´è§‚
4. **æ¢ç´¢å·¥å…·**: é¡¹ç›®ç»“æ„ç†è§£æ›´æ¸…æ™°

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸæ”¶ç›Š (ç«‹å³å¯ç”¨)
1. åœ¨CIä¸­ä½¿ç”¨`--affected`ä¼˜åŒ–æ„å»ºæ—¶é—´
2. æœ¬åœ°å¼€å‘ä½¿ç”¨Watch Mode
3. åˆ©ç”¨æ–°çš„æ¢ç´¢å·¥å…·æå‡å›¢é˜Ÿåä½œ

### ä¸­æœŸè§„åˆ’ (1-2ä¸ªæœˆ)
1. æ·±åº¦é›†æˆäº¤äº’å¼UIåŠŸèƒ½
2. ä¼˜åŒ–ä»»åŠ¡é…ç½®åˆ©ç”¨æ–°ç‰¹æ€§
3. å»ºç«‹åŸºäº--affectedçš„æ™ºèƒ½éƒ¨ç½²ç­–ç•¥

### é•¿æœŸæ„¿æ™¯ (3-6ä¸ªæœˆ)
1. åˆ©ç”¨Turbo 2.xçš„é«˜çº§ç¼“å­˜ç­–ç•¥
2. é›†æˆæœªæ¥çš„å¾®å‰ç«¯åŠŸèƒ½
3. æ¢ç´¢Turboçš„ä¼ä¸šçº§åŠŸèƒ½

## ğŸ“š å‚è€ƒèµ„æº

- [Turborepo 2.0 å‘å¸ƒå…¬å‘Š](https://turbo.build/blog/turbo-2-0)
- [Turborepo 2.5 å˜æ›´æ—¥å¿—](https://github.com/vercel/turborepo/releases/tag/v2.5.4)
- [è¿ç§»æŒ‡å—](https://turbo.build/repo/docs/upgrading)
- [--affectedæ–‡æ¡£](https://turbo.build/repo/docs/reference/run#--affected)
- [Watch Modeæ–‡æ¡£](https://turbo.build/repo/docs/reference/watch)

---

**å‡çº§æ€»ç»“**: Turborepo 2.5.4å‡çº§åœ†æ»¡æˆåŠŸï¼ç³»ç»Ÿæ€§èƒ½æå‡ã€å¼€å‘ä½“éªŒæ”¹å–„ã€æ–°åŠŸèƒ½ä¸°å¯Œï¼Œé›¶æŠ€æœ¯å€ºåŠ¡ï¼Œå®Œç¾çš„ä¼ä¸šçº§monorepoè§£å†³æ–¹æ¡ˆå‡çº§å…¸èŒƒã€‚

**ç»´æŠ¤å»ºè®®**: å®šæœŸå…³æ³¨Turboæ›´æ–°ï¼Œåˆ©ç”¨æ–°åŠŸèƒ½æŒç»­ä¼˜åŒ–å¼€å‘æµç¨‹ï¼Œä¿æŒæŠ€æœ¯æ ˆçš„å…ˆè¿›æ€§å’Œç«äº‰åŠ›ã€‚ 