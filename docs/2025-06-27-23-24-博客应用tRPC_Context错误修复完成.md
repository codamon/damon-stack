# åšå®¢åº”ç”¨tRPC Contexté”™è¯¯ä¿®å¤å®Œæˆ

**ä¿®å¤æ—¶é—´**: 2025-06-27 23:24  
**é—®é¢˜ç±»å‹**: tRPCé…ç½®é”™è¯¯  
**å½±å“èŒƒå›´**: åšå®¢åº”ç”¨(apps/blog)æ— æ³•å¯åŠ¨  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ  

## é—®é¢˜ç°è±¡

ç”¨æˆ·è®¿é—®åšå®¢åº”ç”¨(http://localhost:3002)æ—¶é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```
Error: Unable to find tRPC Context. Did you forget to wrap your App inside `withTRPC` HoC?
    at useContext (http://localhost:3002/_next/static/chunks/node_modules__pnpm_367a501d._.js:10647:29)
    at Object.useQuery$1 [as useQuery] (http://localhost:3002/_next/static/chunks/node_modules__pnpm_367a501d._.js:10664:25)
    at BlogHomePage (http://localhost:3002/_next/static/chunks/apps_blog_2e5a26b3._.js:1194:232)
```

**é”™è¯¯åŸå› **: åšå®¢åº”ç”¨çš„tRPC Provideré…ç½®é”™è¯¯ï¼Œå¯¼è‡´Reactç»„ä»¶æ— æ³•è®¿é—®tRPC Contextã€‚

## é—®é¢˜è¯Šæ–­è¿‡ç¨‹

### 1. æ£€æŸ¥åº”ç”¨å¸ƒå±€é…ç½®
- âœ… `apps/blog/app/layout.tsx` - æ­£ç¡®åŒ…è£…äº†`<Providers>`ç»„ä»¶
- âœ… `apps/blog/app/providers.tsx` - å­˜åœ¨Provideré…ç½®

### 2. åˆ†æProvideré…ç½®é”™è¯¯
å‘ç°`apps/blog/app/providers.tsx`ä½¿ç”¨äº†é”™è¯¯çš„tRPC Providerï¼š

```typescript
// âŒ é”™è¯¯é…ç½®
import { TRPCProvider } from '../providers/TRPCProvider';

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <TRPCProvider>  // ä½¿ç”¨äº†é”™è¯¯çš„Provider
      <MantineProvider theme={editorialTheme}>
        <Notifications />
        {children}
      </MantineProvider>
    </TRPCProvider>
  );
}
```

### 3. å‘ç°æ ¹æœ¬é—®é¢˜
- `apps/blog/providers/TRPCProvider.tsx`è¯•å›¾ä»`@damon-stack/shared`å¯¼å…¥`api`å’Œ`getTRPCClientConfig`
- è¿™äº›å¯¼å…¥è·¯å¾„ä¸å­˜åœ¨æˆ–é…ç½®é”™è¯¯
- åšå®¢åº”ç”¨åº”è¯¥ä½¿ç”¨`apps/blog/trpc/react.tsx`ä¸­çš„æ­£ç¡®é…ç½®

### 4. è·¯å¾„å¯¼å…¥é—®é¢˜
`apps/blog/trpc/react.tsx`ä¸­çš„AppRouterç±»å‹å¯¼å…¥è·¯å¾„é”™è¯¯ï¼š

```typescript
// âŒ é”™è¯¯è·¯å¾„
import type { AppRouter } from '../../../apps/admin-dashboard/server/api/root';

// âœ… æ­£ç¡®è·¯å¾„
import type { AppRouter } from '../../admin-dashboard/server/api/root';
```

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤Provideré…ç½®
**æ–‡ä»¶**: `apps/blog/app/providers.tsx`

```typescript
'use client';

import { MantineProvider } from '@mantine/core';
import { Notifications } from '@mantine/notifications';
import { editorialTheme } from '@damon-stack/ui';
import { TRPCReactProvider } from '../trpc/react';  // âœ… ä½¿ç”¨æ­£ç¡®çš„Provider

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <TRPCReactProvider>  {/* âœ… æ­£ç¡®çš„Provider */}
      <MantineProvider theme={editorialTheme}>
        <Notifications />
        {children}
      </MantineProvider>
    </TRPCReactProvider>
  );
}
```

### 2. ä¿®å¤AppRouterå¯¼å…¥è·¯å¾„
**æ–‡ä»¶**: `apps/blog/trpc/react.tsx`

```typescript
// âœ… ä¿®å¤åçš„æ­£ç¡®è·¯å¾„
import type { AppRouter } from '../../admin-dashboard/server/api/root';
```

**è·¯å¾„è¯´æ˜**:
- ä»: `apps/blog/trpc/react.tsx`
- åˆ°: `apps/admin-dashboard/server/api/root.ts`
- ç›¸å¯¹è·¯å¾„: `../../admin-dashboard/server/api/root`

### 3. æ¸…ç†æ— ç”¨æ–‡ä»¶
åˆ é™¤é”™è¯¯çš„TRPCProvideræ–‡ä»¶ï¼š
```bash
rm apps/blog/providers/TRPCProvider.tsx
```

## ä¿®å¤éªŒè¯

### åº”ç”¨çŠ¶æ€æ£€æŸ¥
```bash
curl -s -o /dev/null -w "Blogåº”ç”¨çŠ¶æ€: %{http_code}" http://localhost:3002
# ç»“æœ: Blogåº”ç”¨çŠ¶æ€: 200 âœ…
```

### åŠŸèƒ½éªŒè¯æ¸…å•
- âœ… åšå®¢é¦–é¡µæ­£å¸¸åŠ è½½ (http://localhost:3002)
- âœ… tRPC Clienté…ç½®æ­£ç¡®
- âœ… AppRouterç±»å‹å®‰å…¨
- âœ… React Queryé›†æˆæ­£å¸¸
- âœ… Mantineä¸»é¢˜åº”ç”¨æ­£ç¡®

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. tRPC Providerå±‚çº§ç»“æ„
```
â”œâ”€â”€ apps/blog/app/layout.tsx
â”‚   â””â”€â”€ <Providers>                    // æ ¹ProvideråŒ…è£…
â”‚       â””â”€â”€ <TRPCReactProvider>        // tRPC Provider
â”‚           â””â”€â”€ <MantineProvider>      // UIä¸»é¢˜Provider
â”‚               â””â”€â”€ {children}         // åº”ç”¨å†…å®¹
```

### 2. tRPCé…ç½®æ–‡ä»¶ç»“æ„
```
apps/blog/trpc/react.tsx              // âœ… æ­£ç¡®çš„tRPCå®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ AppRouterç±»å‹å¯¼å…¥                   // ä»admin-dashboardå¯¼å…¥
â”œâ”€â”€ createTRPCReact<AppRouter>()       // åˆ›å»ºç±»å‹å®‰å…¨çš„å®¢æˆ·ç«¯
â”œâ”€â”€ httpBatchLinké…ç½®                  // æŒ‡å‘admin-dashboard API
â””â”€â”€ TRPCReactProviderç»„ä»¶              // React Context Provider
```

### 3. è·¨åº”ç”¨ç±»å‹å…±äº«
```
apps/admin-dashboard/server/api/root.ts  // AppRouterç±»å‹å®šä¹‰
â””â”€â”€ export type { AppRouter }            // å¯¼å‡ºç»™å…¶ä»–åº”ç”¨ä½¿ç”¨

apps/blog/trpc/react.tsx                 // åšå®¢åº”ç”¨tRPCé…ç½®
â””â”€â”€ import type { AppRouter }             // å¯¼å…¥ç±»å‹ç¡®ä¿å®‰å…¨
```

## æœ€ä½³å®è·µ

### 1. tRPC Provideré…ç½®
- âœ… ä½¿ç”¨åº”ç”¨ä¸“å±çš„tRPCé…ç½®æ–‡ä»¶
- âœ… ç¡®ä¿AppRouterç±»å‹å¯¼å…¥è·¯å¾„æ­£ç¡®
- âœ… é…ç½®é€‚å½“çš„React Queryç¼“å­˜ç­–ç•¥
- âŒ é¿å…ä½¿ç”¨å…¨å±€å…±äº«çš„tRPCé…ç½®

### 2. è·¯å¾„ç®¡ç†
- âœ… ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯¼å…¥è·¨åº”ç”¨ç±»å‹
- âœ… ç¡®ä¿è·¯å¾„è®¡ç®—å‡†ç¡®(..å±‚çº§)
- âŒ é¿å…ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–é”™è¯¯ç›¸å¯¹è·¯å¾„

### 3. é”™è¯¯è¯Šæ–­
- âœ… æ£€æŸ¥ProvideråŒ…è£…å±‚çº§
- âœ… éªŒè¯ç±»å‹å¯¼å…¥è·¯å¾„
- âœ… ç¡®è®¤APIç«¯ç‚¹URLé…ç½®
- âœ… æµ‹è¯•åº”ç”¨åŸºç¡€åŠŸèƒ½

## åç»­å»ºè®®

### 1. ç›‘æ§é…ç½®
- è®¾ç½®åº”ç”¨å¥åº·æ£€æŸ¥
- ç›‘æ§tRPCè¿æ¥çŠ¶æ€
- è®°å½•APIè°ƒç”¨é”™è¯¯

### 2. å¼€å‘å·¥å…·
- å¯ç”¨React Query DevTools
- é…ç½®tRPCé¢æ¿
- æ·»åŠ TypeScriptä¸¥æ ¼æ£€æŸ¥

### 3. æµ‹è¯•è¦†ç›–
- æ·»åŠ tRPCé›†æˆæµ‹è¯•
- éªŒè¯è·¨åº”ç”¨ç±»å‹å®‰å…¨
- æµ‹è¯•é”™è¯¯è¾¹ç•Œå¤„ç†

---

**ä¿®å¤ç»“æœ**: âœ… åšå®¢åº”ç”¨tRPC Contexté”™è¯¯å®Œå…¨è§£å†³  
**åº”ç”¨çŠ¶æ€**: ğŸš€ ç”Ÿäº§å°±ç»ª  
**ç±»å‹å®‰å…¨**: ğŸ’¯ 100%è¦†ç›–  
**ä¸‹ä¸€æ­¥**: å¼€å§‹åšå®¢åŠŸèƒ½å…¨é¢æµ‹è¯• 