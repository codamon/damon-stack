# Dashboard åŸºç¡€ç»“æ„ä¸è·¯ç”±é…ç½®å®Œæˆ

**æ—¶é—´**: 2025-06-25 23:14  
**ä»»åŠ¡**: Dashboard é¡µé¢åŸºç¡€ç»“æ„ä¸è·¯ç”± - ç¬¬ä¸€æ­¥å®Œæˆ

## ä»»åŠ¡æ¦‚è¿°

å»ºç«‹ `/dashboard` è·¯ç”±ï¼Œå°†å…¶è®¾ç½®ä¸ºç”¨æˆ·ç™»å½•åçš„é»˜è®¤ç€é™†é¡µï¼Œç¡®ä¿æ­£ç¡®åº”ç”¨åå°ä¸»å¸ƒå±€ã€‚

## å®æ–½å†…å®¹

### âœ… å·²å®Œæˆçš„é…ç½®

#### ğŸ”„ **é‡è¦ä¼˜åŒ–** (2025-06-25 23:14)
1. **æ ¹è·¯ç”±é‡å®šå‘**: å·²ç™»å½•ç”¨æˆ·è®¿é—® `/` è‡ªåŠ¨é‡å®šå‘åˆ° `/dashboard`
2. **NextAuth é‡å®šå‘é…ç½®**: ç™»å½•åé»˜è®¤é‡å®šå‘åˆ° `/dashboard`

#### 1. Dashboard è·¯ç”±ç»“æ„
**æ–‡ä»¶**: `apps/admin-dashboard/app/dashboard/`
- âœ… `layout.tsx` - Dashboard ä¸“ç”¨å¸ƒå±€
- âœ… `page.tsx` - Dashboard ä¸»é¡µé¢

#### 2. Dashboard Layout é…ç½®
**æ–‡ä»¶**: `apps/admin-dashboard/app/dashboard/layout.tsx`

```typescript
import { ReactNode } from 'react';
import { Layout } from '../../components';

interface DashboardLayoutProps {
  children: ReactNode;
}

export default function DashboardLayout({ children }: DashboardLayoutProps) {
  return (
    <Layout>
      {children}
    </Layout>
  );
}
```

**ä½œç”¨è¯´æ˜**:
- ä¸º `/dashboard` è·¯ç”±åº”ç”¨ç»Ÿä¸€çš„åå°ç®¡ç†å¸ƒå±€
- åŒ…è£¹æ‰€æœ‰ dashboard é¡µé¢çš„å­ç»„ä»¶
- ç¡®ä¿å¯¼èˆªæ ã€ä¾§è¾¹æ ç­‰å…±äº«ç»„ä»¶æ­£å¸¸æ˜¾ç¤º

#### 3. å…±äº« AppShell å¸ƒå±€
**æ–‡ä»¶**: `apps/admin-dashboard/components/Layout.tsx`

**ä¸»è¦åŠŸèƒ½**:
- âœ… AppShell å“åº”å¼å¸ƒå±€ï¼ˆHeader + Navbar + Mainï¼‰
- âœ… å¯¼èˆªèœå•é…ç½®ä¸æƒé™æ§åˆ¶
- âœ… ç”¨æˆ·ä¿¡æ¯å±•ç¤ºä¸ç™»å‡ºåŠŸèƒ½
- âœ… è·¯å¾„é«˜äº®ä¸æ´»è·ƒçŠ¶æ€ç®¡ç†

#### 4. å¯¼èˆªèœå•é…ç½®
```typescript
const navigationItems = [
  {
    label: 'ä»ªè¡¨ç›˜',
    href: '/dashboard',
    icon: IconDashboard,
    requireRole: null, // æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è®¿é—®
  },
  {
    label: 'ç”¨æˆ·ç®¡ç†',
    href: '/users',
    icon: IconUsers,
    requireRole: 'admin', // ğŸ”’ ä»…ç®¡ç†å‘˜å¯è®¿é—®
  },
  // ... å…¶ä»–èœå•é¡¹
];
```

**é«˜äº®é€»è¾‘**:
```typescript
const isActive = pathname === item.href || 
  (item.href === '/dashboard' && pathname === '/');
```

#### 5. è·¯ç”±ä¿æŠ¤ä¸é‡å®šå‘
**æ–‡ä»¶**: `apps/admin-dashboard/middleware.ts`

**æ ¸å¿ƒé€»è¾‘**:
```typescript
// å·²ç™»å½•ç”¨æˆ·è®¿é—®è®¤è¯é¡µé¢ â†’ é‡å®šå‘åˆ° /dashboard
if (isAuthenticated && isAuthRoute) {
  return NextResponse.redirect(new URL('/dashboard', req.nextUrl));
}

// æœªç™»å½•ç”¨æˆ·è®¿é—®ä¿æŠ¤è·¯ç”± â†’ é‡å®šå‘åˆ°ç™»å½•é¡µ
if (!isAuthenticated && isProtectedRoute) {
  const signInUrl = new URL('/login', req.nextUrl);
  signInUrl.searchParams.set('callbackUrl', pathname);
  return NextResponse.redirect(signInUrl);
}
```

**ä¿æŠ¤çš„è·¯ç”±**:
```typescript
const protectedRoutes = ['/dashboard', '/profile', '/settings', '/users', '/analytics'];
```

**æ ¹è·¯ç”±é‡å®šå‘é€»è¾‘**:
```typescript
// ğŸ”„ å·²ç™»å½•ç”¨æˆ·è®¿é—®æ ¹è·¯ç”±ï¼Œé‡å®šå‘åˆ°ä»ªè¡¨æ¿
if (isAuthenticated && isRootRoute) {
  return NextResponse.redirect(new URL('/dashboard', req.nextUrl));
}
```

#### 6. NextAuth é‡å®šå‘é…ç½®
**æ–‡ä»¶**: `apps/admin-dashboard/auth.ts`

**ç™»å½•åé‡å®šå‘é€»è¾‘**:
```typescript
async redirect({ url, baseUrl }) {
  // å¦‚æœ URL æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç›´æ¥ä½¿ç”¨
  if (url.startsWith("/")) {
    // å¦‚æœæœ‰æŒ‡å®šçš„å›è°ƒ URLï¼Œä½¿ç”¨å®ƒ
    if (url !== "/") {
      return `${baseUrl}${url}`;
    }
    // å¦åˆ™é»˜è®¤é‡å®šå‘åˆ° dashboard
    return `${baseUrl}/dashboard`;
  }
  
  // é»˜è®¤é‡å®šå‘åˆ° dashboard
  return `${baseUrl}/dashboard`;
}
```

### ğŸ¯ æƒé™æ§åˆ¶ç³»ç»Ÿ

#### æƒé™å±‚çº§
1. **å…¬å…±è·¯ç”±**: `/`, `/login`, `/auth/*` - æ— éœ€è®¤è¯
2. **ä¿æŠ¤è·¯ç”±**: `/dashboard`, `/profile` - éœ€è¦ç™»å½•
3. **ç®¡ç†å‘˜è·¯ç”±**: `/users`, `/analytics`, `/settings` - éœ€è¦ç®¡ç†å‘˜æƒé™

#### æƒé™æ£€æŸ¥æœºåˆ¶
```typescript
// ğŸ”’ æƒé™æ£€æŸ¥ï¼šå¦‚æœèœå•é¡¹éœ€è¦ç‰¹å®šè§’è‰²ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰è¯¥è§’è‰²
const hasRequiredPermission = item.requireRole 
  ? hasRole(item.requireRole) 
  : isAuthenticated;

// å¦‚æœç”¨æˆ·æ²¡æœ‰æ‰€éœ€æƒé™ï¼Œä¸æ¸²æŸ“è¯¥èœå•é¡¹
if (!hasRequiredPermission) {
  return null;
}
```

## æŠ€æœ¯ç‰¹ç‚¹

### 1. å“åº”å¼è®¾è®¡
- ç§»åŠ¨ç«¯æ±‰å ¡èœå•
- æ¡Œé¢ç«¯å›ºå®šä¾§è¾¹æ 
- è‡ªé€‚åº”å¸ƒå±€è°ƒæ•´

### 2. ç”¨æˆ·ä½“éªŒ
- è·¯å¾„è‡ªåŠ¨é«˜äº®
- æƒé™æ§åˆ¶éšè—ä¸å¯è®¿é—®èœå•
- å¹³æ»‘çš„é¡µé¢è¿‡æ¸¡

### 3. å®‰å…¨æ€§
- è·¯ç”±çº§åˆ«çš„æƒé™æ§åˆ¶
- è‡ªåŠ¨é‡å®šå‘é˜²æ­¢æœªæˆæƒè®¿é—®
- è§’è‰²åŸºç¡€çš„åŠŸèƒ½éš”ç¦»

### 4. å¯ç»´æŠ¤æ€§
- æ¨¡å—åŒ–çš„ç»„ä»¶ç»“æ„
- æ¸…æ™°çš„æƒé™é…ç½®
- ç±»å‹å®‰å…¨çš„ TypeScript å®ç°

## æ–‡ä»¶ç»“æ„

```
apps/admin-dashboard/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ layout.tsx          # Dashboard ä¸“ç”¨å¸ƒå±€
â”‚       â””â”€â”€ page.tsx            # Dashboard ä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ Layout.tsx              # å…±äº« AppShell å¸ƒå±€
â”œâ”€â”€ middleware.ts               # è·¯ç”±ä¿æŠ¤ä¸­é—´ä»¶
â””â”€â”€ hooks/
    â””â”€â”€ use-current-user.ts     # ç”¨æˆ·æƒé™çŠ¶æ€ç®¡ç†
```

## è·¯ç”±æµç¨‹

### ç™»å½•åé‡å®šå‘æµç¨‹
1. ç”¨æˆ·ç™»å½•æˆåŠŸ
2. ä¸­é—´ä»¶æ£€æµ‹åˆ°å·²è®¤è¯çŠ¶æ€
3. å¦‚æœç”¨æˆ·åœ¨è®¤è¯é¡µé¢ â†’ è‡ªåŠ¨é‡å®šå‘åˆ° `/dashboard`
4. Dashboard å¸ƒå±€åŠ è½½ â†’ åº”ç”¨ AppShell
5. æ˜¾ç¤º Dashboard å†…å®¹

### è®¿é—®ä¿æŠ¤æµç¨‹  
1. ç”¨æˆ·è®¿é—®ä¿æŠ¤è·¯ç”±ï¼ˆå¦‚ `/dashboard`ï¼‰
2. ä¸­é—´ä»¶æ£€æŸ¥è®¤è¯çŠ¶æ€
3. æœªç™»å½• â†’ é‡å®šå‘åˆ° `/login?callbackUrl=/dashboard`
4. å·²ç™»å½• â†’ å…è®¸è®¿é—®
5. æ£€æŸ¥é¡µé¢æƒé™ â†’ æ¸²æŸ“ç›¸åº”å†…å®¹

## ä¸‹ä¸€æ­¥æ‰©å±•

è™½ç„¶åŸºç¡€ç»“æ„å·²å®Œå–„ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

1. **Dashboard å†…å®¹å¢å¼º**
   - æ·»åŠ æ•°æ®å¯è§†åŒ–ç»„ä»¶
   - å®ç°å®æ—¶ç»Ÿè®¡ä¿¡æ¯
   - åˆ›å»ºä¸ªæ€§åŒ–ä»ªè¡¨ç›˜

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ‡’åŠ è½½é‡è·¯ç”±ç»„ä»¶
   - ä¼˜åŒ–å¯¼èˆªçŠ¶æ€ç®¡ç†
   - æ·»åŠ é¡µé¢ç¼“å­˜ç­–ç•¥

3. **ç”¨æˆ·ä½“éªŒæå‡**
   - æ·»åŠ é¡µé¢åŠ è½½çŠ¶æ€
   - å®ç°é¢åŒ…å±‘å¯¼èˆª
   - æ”¯æŒå¿«æ·é”®å¯¼èˆª

## çŠ¶æ€

âœ… **å®Œæˆ** - Dashboard åŸºç¡€ç»“æ„ä¸è·¯ç”±é…ç½®å·²å®Œå–„ï¼Œç³»ç»Ÿæ¶æ„ç¨³å®šï¼Œå‡†å¤‡è¿›è¡Œå†…å®¹å¼€å‘ 