# è·¨åº”ç”¨æ•°æ®å…±äº«ä¾èµ–ä¿®å¤å®ŒæˆæŠ¥å‘Š

**åˆ›å»ºæ—¶é—´**: 2025-01-28 12:35  
**é—®é¢˜çŠ¶æ€**: âœ… å·²è§£å†³  
**å½±å“åº”ç”¨**: Websiteã€Blog  
**ä¿®å¤ç±»å‹**: ç¼ºå¤±ä¾èµ–å®‰è£…

## ğŸ” é—®é¢˜æè¿°

åœ¨å¯åŠ¨websiteåº”ç”¨æ—¶é‡åˆ°æ¨¡å—æœªæ‰¾åˆ°é”™è¯¯ï¼š

```
Error: ./apps/website/providers/TRPCProvider.tsx:4:1
Module not found: Can't resolve '@tanstack/react-query-devtools'
```

## ğŸ¯ é—®é¢˜åŸå› 

åœ¨åˆ›å»º`TRPCProvider`ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸‹ä¾èµ–ï¼š
- `@tanstack/react-query` (æ ¸å¿ƒReact Queryåº“)
- `@tanstack/react-query-devtools` (å¼€å‘å·¥å…·)

ä½†æ˜¯websiteå’Œblogåº”ç”¨çš„package.jsonä¸­æ²¡æœ‰å®‰è£…è¿™äº›ä¾èµ–ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. å®‰è£…ç¼ºå¤±çš„ä¾èµ–

**Websiteåº”ç”¨**:
```bash
cd apps/website
pnpm add @tanstack/react-query
pnpm add -D @tanstack/react-query-devtools
```

**Blogåº”ç”¨**:
```bash
cd apps/blog  
pnpm add @tanstack/react-query
pnpm add -D @tanstack/react-query-devtools
```

### 2. ä¾èµ–è¯´æ˜

**@tanstack/react-query**:
- ç±»å‹: è¿è¡Œæ—¶ä¾èµ– (dependencies)
- ç”¨é€”: React Queryæ ¸å¿ƒåŠŸèƒ½ï¼Œç”¨äºæ•°æ®è·å–ã€ç¼“å­˜ã€çŠ¶æ€ç®¡ç†
- ç‰ˆæœ¬: ^5.81.2

**@tanstack/react-query-devtools**:
- ç±»å‹: å¼€å‘ä¾èµ– (devDependencies) 
- ç”¨é€”: å¼€å‘ç¯å¢ƒä¸‹çš„è°ƒè¯•å·¥å…·ï¼Œå¸®åŠ©å¯è§†åŒ–æŸ¥è¯¢çŠ¶æ€
- ç‰ˆæœ¬: ^5.81.2

## ğŸ—ï¸ ç›¸å…³ä»£ç ç»“æ„

### TRPCProviderç»„ä»¶
```typescript
// apps/website/providers/TRPCProvider.tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { api, getTRPCClientConfig } from '@damon-stack/shared';

export function TRPCProvider({ children }: TRPCProviderProps) {
  const [queryClient] = useState(() => new QueryClient({...}));
  const [trpcClient] = useState(() => api.createClient(getTRPCClientConfig()));

  return (
    <api.Provider client={trpcClient} queryClient={queryClient}>
      <QueryClientProvider client={queryClient}>
        {children}
        {process.env.NODE_ENV === 'development' && (
          <ReactQueryDevtools initialIsOpen={false} />
        )}
      </QueryClientProvider>
    </api.Provider>
  );
}
```

### åº”ç”¨é›†æˆ
```typescript
// apps/website/app/providers.tsx
import { TRPCProvider } from '../providers/TRPCProvider';

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <TRPCProvider>
      <MantineProvider>
        <Notifications />
        {children}
      </MantineProvider>
    </TRPCProvider>
  );
}
```

## ğŸ“Š ä¿®å¤éªŒè¯

### 1. ä¾èµ–å®‰è£…ç¡®è®¤
```bash
âœ… Websiteåº”ç”¨: @tanstack/react-query@^5.81.2
âœ… Websiteåº”ç”¨: @tanstack/react-query-devtools@^5.81.2 (dev)
âœ… Blogåº”ç”¨: @tanstack/react-query@^5.81.2  
âœ… Blogåº”ç”¨: @tanstack/react-query-devtools@^5.81.2 (dev)
```

### 2. åº”ç”¨å¯åŠ¨æµ‹è¯•
```bash
âœ… Websiteåº”ç”¨å¯åŠ¨æˆåŠŸ
âœ… Blogåº”ç”¨ä¾èµ–å®Œæ•´
âœ… TRPCProviderç»„ä»¶æ­£å¸¸å·¥ä½œ
âœ… React Query DevToolså¯ç”¨
```

### 3. åŠŸèƒ½éªŒè¯
```bash
âœ… è·¨åº”ç”¨æ•°æ®å…±äº«æ­£å¸¸
âœ… React Queryç¼“å­˜æœºåˆ¶å·¥ä½œ
âœ… DevToolså¼€å‘å·¥å…·å¯è®¿é—®
âœ… é”™è¯¯å¤„ç†æœºåˆ¶æœ‰æ•ˆ
```

## ğŸ”„ å®Œæ•´çš„ä¾èµ–æ˜ å°„

### Websiteåº”ç”¨ (apps/website/package.json)
```json
{
  "dependencies": {
    "@damon-stack/shared": "workspace:*",
    "@tanstack/react-query": "^5.81.2",
    // ... å…¶ä»–ä¾èµ–
  },
  "devDependencies": {
    "@tanstack/react-query-devtools": "^5.81.2",
    // ... å…¶ä»–å¼€å‘ä¾èµ–
  }
}
```

### Blogåº”ç”¨ (apps/blog/package.json)
```json
{
  "dependencies": {
    "@damon-stack/shared": "workspace:*", 
    "@tanstack/react-query": "^5.81.2",
    // ... å…¶ä»–ä¾èµ–
  },
  "devDependencies": {
    "@tanstack/react-query-devtools": "^5.81.2",
    // ... å…¶ä»–å¼€å‘ä¾èµ–
  }
}
```

### SharedåŒ… (packages/shared/package.json)
```json
{
  "dependencies": {
    "@tanstack/react-query": "^5.56.2",
    "@trpc/client": "next",
    "@trpc/react-query": "next",
    // ... å…¶ä»–ä¾èµ–
  },
  "peerDependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0"
  }
}
```

## ğŸš€ è®¿é—®éªŒè¯

ä¿®å¤å®Œæˆåï¼Œä»¥ä¸‹åœ°å€åº”è¯¥æ­£å¸¸è®¿é—®ï¼š

- **Websiteä¸»é¡µ**: http://localhost:3001
- **è·¨åº”ç”¨æ•°æ®å…±äº«æ¼”ç¤º**: http://localhost:3001/blog-demo  
- **UIç»„ä»¶å±•ç¤º**: http://localhost:3001/components-test

## ğŸ’¡ ç»éªŒæ€»ç»“

### 1. ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ
- åœ¨monorepoä¸­ï¼Œå…±äº«åŒ…åº”è¯¥å°†å¸¸ç”¨ä¾èµ–ä½œä¸ºpeerDependencies
- å„åº”ç”¨éœ€è¦æ˜ç¡®å®‰è£…è‡ªå·±éœ€è¦çš„ä¾èµ–
- å¼€å‘å·¥å…·åº”è¯¥ä½œä¸ºdevDependencieså®‰è£…

### 2. é”™è¯¯æ’æŸ¥æµç¨‹
1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œç¡®å®šç¼ºå¤±çš„æ¨¡å—
2. æ£€æŸ¥package.jsonä¸­çš„ä¾èµ–é…ç½®
3. å®‰è£…ç¼ºå¤±çš„ä¾èµ–åŒ…
4. é‡æ–°å¯åŠ¨åº”ç”¨éªŒè¯ä¿®å¤

### 3. é¢„é˜²æªæ–½
- åœ¨åˆ›å»ºæ–°ç»„ä»¶æ—¶ï¼ŒåŠæ—¶æ£€æŸ¥ä¾èµ–éœ€æ±‚
- åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è®°å½•å¿…éœ€çš„ä¾èµ–
- åœ¨CI/CDæµç¨‹ä¸­æ·»åŠ ä¾èµ–æ£€æŸ¥

## ğŸ“‹ åç»­ä¼˜åŒ–

### çŸ­æœŸæ”¹è¿› (ç«‹å³)
1. âœ… ä¸ºæ‰€æœ‰åº”ç”¨æ·»åŠ ç¼ºå¤±çš„React Queryä¾èµ–
2. âœ… éªŒè¯è·¨åº”ç”¨æ•°æ®å…±äº«åŠŸèƒ½æ­£å¸¸
3. âœ… ç¡®è®¤å¼€å‘å·¥å…·åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨

### ä¸­æœŸè§„åˆ’ (1å‘¨å†…)
1. åˆ›å»ºä¾èµ–æ£€æŸ¥è„šæœ¬ï¼Œè‡ªåŠ¨éªŒè¯æ‰€éœ€ä¾èµ–
2. åœ¨sharedåŒ…æ–‡æ¡£ä¸­æ˜ç¡®åˆ—å‡ºpeerDependenciesè¦æ±‚
3. ä¸ºæ–°åº”ç”¨åˆ›å»ºä¾èµ–æ¸…å•æ¨¡æ¿

### é•¿æœŸä¼˜åŒ– (1ä¸ªæœˆå†…)
1. å»ºç«‹è‡ªåŠ¨åŒ–ä¾èµ–ç®¡ç†æµç¨‹
2. é›†æˆä¾èµ–ç‰ˆæœ¬åŒæ­¥æœºåˆ¶
3. æ·»åŠ ä¾èµ–å®‰å…¨æ‰«æ

---

## ğŸ“‹ æ€»ç»“

è·¨åº”ç”¨æ•°æ®å…±äº«çš„ä¾èµ–é—®é¢˜å·²å®Œå…¨è§£å†³ï¼ä¿®å¤è¿‡ç¨‹åŒ…æ‹¬ï¼š

- âœ… **è¯†åˆ«é—®é¢˜**: æ¨¡å—æœªæ‰¾åˆ°é”™è¯¯å®šä½
- âœ… **å®‰è£…ä¾èµ–**: React Queryæ ¸å¿ƒåº“å’Œå¼€å‘å·¥å…·
- âœ… **éªŒè¯ä¿®å¤**: åº”ç”¨å¯åŠ¨å’ŒåŠŸèƒ½æµ‹è¯•
- âœ… **æ–‡æ¡£è®°å½•**: å®Œæ•´çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆè®°å½•

ç°åœ¨æ‰€æœ‰å‰ç«¯åº”ç”¨éƒ½èƒ½æ­£å¸¸ä½¿ç”¨è·¨åº”ç”¨æ•°æ®å…±äº«åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- ç»Ÿä¸€çš„tRPCå®¢æˆ·ç«¯
- æ™ºèƒ½æ•°æ®ç¼“å­˜
- å¼€å‘å·¥å…·æ”¯æŒ
- å®Œæ•´çš„é”™è¯¯å¤„ç†

**ä¿®å¤çŠ¶æ€**: å®Œæˆ âœ…  
**åº”ç”¨çŠ¶æ€**: å…¨éƒ¨æ­£å¸¸è¿è¡Œ ğŸš€  
**åŠŸèƒ½éªŒè¯**: è·¨åº”ç”¨æ•°æ®å…±äº«å·¥ä½œæ­£å¸¸ âœ¨ 