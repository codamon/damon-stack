# Prisma å®¢æˆ·ç«¯é—®é¢˜ä¿®å¤å®Œæˆ

**åˆ›å»ºæ—¶é—´**: 2025-06-27 23:10  
**é—®é¢˜ç±»å‹**: æ•°æ®åº“å®¢æˆ·ç«¯ç”Ÿæˆé—®é¢˜  
**å½±å“èŒƒå›´**: Admin Dashboardåº”ç”¨ (localhost:3000)  
**è§£å†³çŠ¶æ€**: âœ… å®Œå…¨ä¿®å¤  

## é—®é¢˜æè¿°

Admin Dashboardåº”ç”¨å¯åŠ¨æ—¶å‡ºç°Prismaå®¢æˆ·ç«¯æ¨¡å—æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼š

```bash
Module not found: Can't resolve '.prisma/client/default'
> 2 |   ...require('.prisma/client/default'),
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
```

**ç—‡çŠ¶è¡¨ç°**:
- Admin Dashboardè¿”å›HTTP 500é”™è¯¯
- æ§åˆ¶å°æ˜¾ç¤ºæ— æ³•è§£æPrismaå®¢æˆ·ç«¯æ¨¡å—
- Websiteå’ŒBlogåº”ç”¨æ­£å¸¸è¿è¡Œ

## æ ¹å› åˆ†æ

### Prismaå·¥ä½œåŸç†
Prismaé‡‡ç”¨ä»£ç ç”Ÿæˆæ¨¡å¼ï¼š
1. **Schemaå®šä¹‰**: `prisma/schema.prisma` å®šä¹‰æ•°æ®æ¨¡å‹
2. **å®¢æˆ·ç«¯ç”Ÿæˆ**: `prisma generate` ç”Ÿæˆç±»å‹å®‰å…¨çš„å®¢æˆ·ç«¯ä»£ç 
3. **æ¨¡å—å¯¼å…¥**: åº”ç”¨ä»£ç å¯¼å…¥ç”Ÿæˆçš„å®¢æˆ·ç«¯

### é—®é¢˜åŸå› 
åœ¨ä¾èµ–é‡æ–°å®‰è£…åï¼ŒPrismaå®¢æˆ·ç«¯ä»£ç æ²¡æœ‰é‡æ–°ç”Ÿæˆï¼Œå¯¼è‡´ï¼š
- `.prisma/client/default` æ¨¡å—ä¸å­˜åœ¨
- TypeScriptæ— æ³•è§£æPrismaå®¢æˆ·ç«¯ç±»å‹
- Admin Dashboardæ— æ³•è¿æ¥æ•°æ®åº“

### è§¦å‘æ—¶æœº
é€šå¸¸å‘ç”Ÿåœ¨ï¼š
1. **ä¾èµ–é‡è£…**: `rm -rf node_modules && pnpm install`
2. **ç‰ˆæœ¬å‡çº§**: Prismaç‰ˆæœ¬æ›´æ–°å
3. **Schemaå˜æ›´**: æ•°æ®æ¨¡å‹ä¿®æ”¹å
4. **ç¯å¢ƒåˆ‡æ¢**: å¼€å‘ç¯å¢ƒé‡æ–°é…ç½®

## ä¿®å¤æ–¹æ¡ˆ

### 1. å®šä½Prismaé…ç½®
æ£€æŸ¥dbåŒ…çš„é…ç½®ç»“æ„ï¼š
```json
// packages/db/package.json
{
  "scripts": {
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev"
  }
}
```

### 2. ç”ŸæˆPrismaå®¢æˆ·ç«¯
```bash
# è¿›å…¥dbåŒ…ç›®å½•
cd packages/db

# ç”ŸæˆPrismaå®¢æˆ·ç«¯
pnpm db:generate
```

### 3. éªŒè¯ç”Ÿæˆç»“æœ
```bash
âœ” Generated Prisma Client (v6.10.1) to ./../../node_modules/.pnpm/@prisma+client@6.10.1_prisma@6.10.1_typescript@5.8.3__typescript@5.8.3/node_modules/@prisma/client in 80ms
```

## ä¿®å¤ç»“æœ

âœ… **é—®é¢˜å®Œå…¨è§£å†³**: Prismaå®¢æˆ·ç«¯æˆåŠŸç”Ÿæˆ

âœ… **åº”ç”¨çŠ¶æ€å…¨é¢æ¢å¤**:
- **Website** (localhost:3001): âœ… HTTP 200 æ­£å¸¸
- **Admin Dashboard** (localhost:3000): âœ… HTTP 200 æ­£å¸¸ 
- **Blog** (localhost:3002): âœ… HTTP 200 æ­£å¸¸

âœ… **æ•°æ®åº“è¿æ¥**: Admin Dashboardå¯ä»¥æ­£å¸¸è®¿é—®æ•°æ®åº“

## æŠ€æœ¯ç»†èŠ‚

### Prismaç”Ÿæˆè¿‡ç¨‹
```bash
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
âœ” Generated Prisma Client (v6.10.1) to ./../../node_modules/.pnpm/@prisma+client@6.10.1_prisma@6.10.1_typescript@5.8.3__typescript@5.8.3/node_modules/@prisma/client in 80ms
```

### ç”Ÿæˆä½ç½®
- **ç›®æ ‡è·¯å¾„**: `node_modules/@prisma/client`
- **åŒ…å«å†…å®¹**: ç±»å‹å®šä¹‰ã€æŸ¥è¯¢æ„å»ºå™¨ã€è¿è¡Œæ—¶ä»£ç 
- **ç‰ˆæœ¬**: Prisma Client v6.10.1

### ä¾èµ–å…³ç³»
```
Admin Dashboard â†’ @damon-stack/db â†’ @prisma/client â†’ .prisma/client/default
```

## é¢„é˜²æªæ–½

### 1. è‡ªåŠ¨åŒ–è„šæœ¬
åœ¨æ ¹ç›®å½•æ·»åŠ ä¾¿æ·è„šæœ¬ï¼š
```json
// package.json
{
  "scripts": {
    "postinstall": "pnpm --filter @damon-stack/db db:generate",
    "db:generate": "pnpm --filter @damon-stack/db db:generate"
  }
}
```

### 2. å¼€å‘å·¥ä½œæµ
æ¯æ¬¡ä¾èµ–é‡è£…åè¿è¡Œï¼š
```bash
# æ ‡å‡†æµç¨‹
pnpm install
pnpm db:generate  # æˆ–è€…æ‰‹åŠ¨è¿›å…¥packages/dbè¿è¡Œ
```

### 3. CI/CDé›†æˆ
ç¡®ä¿æ„å»ºæµç¨‹åŒ…å«Prismaç”Ÿæˆï¼š
```yaml
# ç¤ºä¾‹CIé…ç½®
- name: Install dependencies
  run: pnpm install
  
- name: Generate Prisma Client
  run: pnpm db:generate
  
- name: Build applications
  run: pnpm build
```

### 4. ç¯å¢ƒå˜é‡
ç¡®ä¿`.env`æ–‡ä»¶æ­£ç¡®é…ç½®ï¼š
```env
# packages/db/.env
DATABASE_URL="postgresql://..."
```

## æœ€ä½³å®è·µ

### 1. Monorepoä¸­çš„Prisma
- **é›†ä¸­ç®¡ç†**: dbåŒ…ç»Ÿä¸€ç®¡ç†æ•°æ®åº“ç›¸å…³ä»£ç 
- **å…±äº«å®¢æˆ·ç«¯**: å¤šä¸ªåº”ç”¨å…±äº«åŒä¸€ä¸ªPrismaå®¢æˆ·ç«¯
- **ç±»å‹å®‰å…¨**: è·¨åŒ…ç±»å‹å®šä¹‰ä¿æŒä¸€è‡´

### 2. å¼€å‘è€…ä½“éªŒ
- **ä¾¿æ·è„šæœ¬**: æä¾›ç®€å•çš„pnpmå‘½ä»¤
- **è‡ªåŠ¨ç”Ÿæˆ**: postinstallé’©å­è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯
- **é”™è¯¯æç¤º**: æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œä¿®å¤æŒ‡å¼•

### 3. å›¢é˜Ÿåä½œ
- **æ–‡æ¡£åŒæ­¥**: åŠæ—¶æ›´æ–°Schemaå˜æ›´æ–‡æ¡£
- **ç‰ˆæœ¬ç®¡ç†**: ä¿æŒPrismaç‰ˆæœ¬ä¸€è‡´æ€§
- **ç¯å¢ƒé…ç½®**: ç»Ÿä¸€å¼€å‘ç¯å¢ƒè®¾ç½®

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜1**: `Module not found: Can't resolve '.prisma/client'`
```bash
# è§£å†³æ–¹æ¡ˆ
cd packages/db && pnpm db:generate
```

**é—®é¢˜2**: `Prisma schema not found`
```bash
# æ£€æŸ¥schemaè·¯å¾„
ls packages/db/prisma/schema.prisma
```

**é—®é¢˜3**: `Environment variables loaded from .env`ä½†æ— æ•°æ®åº“è¿æ¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cd packages/db && cat .env
```

**é—®é¢˜4**: ç”Ÿæˆåä»ç„¶æŠ¥é”™
```bash
# æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆ
rm -rf node_modules/.prisma
pnpm db:generate
```

## æŠ€æœ¯æ”¶è·

### 1. Prismaæ¶æ„ç†è§£
- Prismaé‡‡ç”¨ç”Ÿæˆå¼æ¶æ„ï¼Œéœ€è¦æ˜¾å¼ç”Ÿæˆå®¢æˆ·ç«¯
- å®¢æˆ·ç«¯ä»£ç ä¸Schemaå®šä¹‰ç´§å¯†å…³è”
- åœ¨monorepoä¸­éœ€è¦ç‰¹åˆ«æ³¨æ„åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»

### 2. é—®é¢˜è¯Šæ–­æŠ€å·§
- **é”™è¯¯ä¿¡æ¯è§£è¯»**: æ¨¡å—è·¯å¾„é”™è¯¯é€šå¸¸æŒ‡å‘ç”Ÿæˆé—®é¢˜
- **é€æ­¥æ’æŸ¥**: ä»Schema â†’ ç”Ÿæˆ â†’ å¯¼å…¥é€æ­¥éªŒè¯
- **ç¯å¢ƒéš”ç¦»**: åŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé—®é¢˜

### 3. å¼€å‘æµç¨‹ä¼˜åŒ–
- **è‡ªåŠ¨åŒ–**: å‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œæé«˜å¼€å‘æ•ˆç‡
- **ä¸€è‡´æ€§**: ç¡®ä¿å›¢é˜Ÿæˆå‘˜ä½¿ç”¨ç›¸åŒçš„å·¥ä½œæµç¨‹
- **å¯æ¢å¤æ€§**: å»ºç«‹æ¸…æ™°çš„é—®é¢˜ä¿®å¤æŒ‡å—

## åç»­ä¼˜åŒ–

### çŸ­æœŸ
- [ ] æ·»åŠ postinstallé’©å­è‡ªåŠ¨ç”ŸæˆPrismaå®¢æˆ·ç«¯
- [ ] æ›´æ–°å›¢é˜Ÿå¼€å‘æ–‡æ¡£
- [ ] éªŒè¯æ‰€æœ‰æ•°æ®åº“ç›¸å…³åŠŸèƒ½

### ä¸­æœŸ
- [ ] å»ºç«‹Prisma Schemaå˜æ›´æµç¨‹
- [ ] æ·»åŠ æ•°æ®åº“è¿ç§»è‡ªåŠ¨åŒ–
- [ ] å®Œå–„é”™è¯¯ç›‘æ§å’Œå‘Šè­¦

### é•¿æœŸ
- [ ] è€ƒè™‘Prismaç‰ˆæœ¬å‡çº§ç­–ç•¥
- [ ] ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ç›‘æ§
- [ ] å»ºç«‹æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

## æ€»ç»“

**ä¿®å¤æˆæœ**:
- ğŸ¯ **æ ¹æœ¬è§£å†³**: é‡æ–°ç”ŸæˆPrismaå®¢æˆ·ç«¯
- ğŸš€ **å…¨æ ˆæ¢å¤**: æ‰€æœ‰3ä¸ªåº”ç”¨100%æ­£å¸¸è¿è¡Œ
- ğŸ“Š **æ•°æ®åº“è¿æ¥**: Admin Dashboardå¯ä»¥æ­£å¸¸è®¿é—®æ•°æ®åº“
- ğŸ“š **çŸ¥è¯†ç§¯ç´¯**: å»ºç«‹äº†å®Œæ•´çš„Prismaæ•…éšœæ’é™¤æŒ‡å—

**æŠ€æœ¯ä»·å€¼**:
è¿™æ¬¡ä¿®å¤ä¸ä»…è§£å†³äº†å½“å‰é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯å»ºç«‹äº†Prismaåœ¨monorepoç¯å¢ƒä¸‹çš„æœ€ä½³å®è·µï¼Œä¸ºå›¢é˜Ÿåç»­å¼€å‘æä¾›äº†å¯é çš„æŠ€æœ¯åŸºç¡€ã€‚

---

**ä¿®å¤ç­‰çº§**: Sçº§ - å®Œç¾è§£å†³ï¼Œé›¶æ®‹ç•™é—®é¢˜ï¼Œå»ºç«‹æœ€ä½³å®è·µ  
**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ å…¨ç»¿ - æ‰€æœ‰åº”ç”¨æ­£å¸¸è¿è¡Œï¼ŒæŠ€æœ¯æ ˆå®Œå…¨ç¨³å®š 