# TSUP æ„å»ºæµç¨‹ä¸ React Context è·¨åŒ…é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆæ€»ç»“

**æ—¶é—´**: 2025-06-25 17:30  
**é¡¹ç›®**: damon-stack Monorepo  
**çŠ¶æ€**: âœ… å®Œå…¨æˆåŠŸ  

## ä¼šè¯æ€»ç»“

### é¡¹ç›®èƒŒæ™¯
ç”¨æˆ·çš„ damon-stack é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Next.js 15 + Mantine 8 çš„ monorepoï¼Œé‡åˆ°äº† React Context æ— æ³•è·¨åŒ…å…±äº«çš„é—®é¢˜ã€‚ç”¨æˆ·è¦æ±‚å®æ–½ TSUP æ„å»ºæµç¨‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### æ ¸å¿ƒæŒ‘æˆ˜
**åˆå§‹é—®é¢˜**: å…±äº« UI åŒ…ä¸­çš„ Mantine ç»„ä»¶æ— æ³•è®¿é—®ä¸»åº”ç”¨çš„ MantineProvider Contextï¼Œå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼š
```
Error: @mantine/core: MantineProvider was not found in component tree
```

**æ ¹æœ¬åŸå› **: ä¾èµ–åŒé‡å®ä¾‹é—®é¢˜ - åœ¨å¤æ‚çš„ Monorepo + pnpm ç¯å¢ƒä¸­ï¼Œå­˜åœ¨å¤šä¸ª @mantine/core å’Œ react å®ä¾‹ï¼Œå¯¼è‡´ä¸¤ä¸ªç‹¬ç«‹çš„ React Context æ— æ³•è·¨è¾¹ç•Œè®¿é—®ã€‚

## æŠ€æœ¯å®æ–½å†ç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šTSUP æ„å»ºæµç¨‹å®æ–½ âœ…

**å®æ–½æ­¥éª¤**:
1. **TSUP æ„å»ºå·¥å…·é…ç½®**
   - ä¸º `packages/ui` å®‰è£… TSUP (^8.5.0)
   - åˆ›å»º `tsup.config.ts` é…ç½®æ–‡ä»¶
   - é…ç½®åŒæ ¼å¼è¾“å‡º (ESM + CommonJS)
   - è®¾ç½®å…³é”®çš„ external é…ç½®

2. **packages/ui package.json ä¼˜åŒ–**
   - æ·»åŠ æ„å»ºè„šæœ¬ï¼š`"build": "tsup"` å’Œ `"dev": "tsup --watch"`
   - é…ç½®ç°ä»£åŒ– exports å­—æ®µ
   - è®¾ç½® files å­—æ®µç¡®ä¿åªå‘å¸ƒæ„å»ºäº§ç‰©

3. **ä¸»åº”ç”¨ TypeScript é…ç½®ä¼˜åŒ–**
   - ä¿®æ”¹è·¯å¾„é…ç½®æŒ‡å‘æ„å»ºäº§ç‰©
   - ç¡®ä¿ç±»å‹è§£ææ­£ç¡®

4. **Turborepo ä»»åŠ¡ä¾èµ–é…ç½®**
   - æ›´æ–° `turbo.json`ï¼Œä¸º dev ä»»åŠ¡æ·»åŠ  `"dependsOn": ["^build"]`

**æˆæœ**:
- âœ… TSUP æ„å»ºæµç¨‹å®Œç¾è¿è¡Œ
- âœ… åŒæ ¼å¼äº§ç‰©ç”Ÿæˆ (ESM + CJS + TypeScript)
- âœ… æ„å»ºäº§ç‰©ï¼šindex.js (2.2KB), index.mjs (1.8KB), index.d.ts (920B)

### ç¬¬äºŒé˜¶æ®µï¼šä¾èµ–åŒé‡å®ä¾‹é—®é¢˜è¯Šæ–­ ğŸ”

**é—®é¢˜å‘ç°**:
å°½ç®¡ TSUP æ„å»ºæˆåŠŸï¼Œè¿è¡Œæ—¶ä»å‡ºç° Context é”™è¯¯ã€‚æ·±å…¥åˆ†æå‘ç°ï¼š

**ç‰ˆæœ¬å†²çªåˆ†æ**:
- admin-dashboard: react ^19.0.0, @types/react ^19
- packages/ui: react ^19.1.0, @types/react ^18.0.0
- ç»†å¾®çš„ç‰ˆæœ¬å·®å¼‚å¯¼è‡´å¤šä¸ªä¾èµ–å®ä¾‹

**éªŒè¯æ–¹æ³•**:
```bash
find node_modules -path "*/@mantine/core" -type d
# å‘ç°å¤šä¸ªå®ä¾‹è·¯å¾„
```

### ç¬¬ä¸‰é˜¶æ®µï¼špnpm overrides è§£å†³æ–¹æ¡ˆ ğŸ¯

**è§£å†³æ–¹æ¡ˆå®æ–½**:

**1. ç‰ˆæœ¬ç»Ÿä¸€é…ç½®**
åœ¨æ ¹ç›®å½• `package.json` æ·»åŠ ï¼š
```json
{
  "pnpm": {
    "overrides": {
      "@mantine/core": "8.1.1",
      "@mantine/hooks": "8.1.1", 
      "react": "19.0.0",
      "react-dom": "19.0.0",
      "@types/react": "19.1.6",
      "@types/react-dom": "19.1.6"
    }
  }
}
```

**2. å®Œæ•´é‡æ–°å®‰è£…**
```bash
# æ¸…ç†ç°æœ‰ä¾èµ–
rm -rf node_modules pnpm-lock.yaml

# é‡æ–°å®‰è£…ä¾èµ–
pnpm install

# é‡æ–°æ„å»º UI åŒ…
pnpm --filter @damon-stack/ui build

# å¯åŠ¨åº”ç”¨
pnpm dev
```

**å…³é”®æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬å·ï¼ˆæ—  ^ å‰ç¼€ï¼‰
- å¼ºåˆ¶æ•´ä¸ª monorepo ä½¿ç”¨ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬
- é‡æ–°å®‰è£…ç¡®ä¿ overrides è§„åˆ™å®Œå…¨ç”Ÿæ•ˆ

## éªŒè¯ç»“æœ

### âœ… æŠ€æœ¯æŒ‡æ ‡éªŒè¯

**1. ä¾èµ–ç»Ÿä¸€éªŒè¯**
```bash
$ find node_modules -path "*/@mantine/core" -type d
node_modules/.pnpm/@mantine+core@8.1.1_@mantine+hooks@8.1.1_react@19.0.0__@types+react@19.1.6_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@mantine/core
```
- âœ… åªæœ‰ä¸€ä¸ª @mantine/core å®ä¾‹
- âœ… ç»Ÿä¸€çš„ä¾èµ–è·¯å¾„æ˜¾ç¤ºç‰ˆæœ¬å®Œå…¨ä¸€è‡´

**2. Context é”™è¯¯æ¶ˆé™¤**
- âŒ ä¸å†æœ‰ "MantineProvider was not found" é”™è¯¯
- âœ… Mantine ç»„ä»¶æ­£å¸¸æ¸²æŸ“
- âœ… CSS ç±»æ­£å¸¸ç”Ÿæˆ: `.mantine-Center-root`, `.mantine-Stack-root`
- âœ… `data-mantine-color-scheme="light"` æ­£å¸¸è®¾ç½®

**3. åº”ç”¨æ­£å¸¸è¿è¡Œ**
- âœ… HTTP 200 å“åº”æ­£å¸¸
- âœ… æ„å»ºäº§ç‰©å®Œæ•´
- âœ… æ—  peer dependency è­¦å‘Š
- âœ… å¼€å‘æœåŠ¡å™¨æµç•…è¿è¡Œ

## ç”Ÿæˆæ–‡æ¡£è®°å½•

ä¼šè¯æœŸé—´ç”Ÿæˆäº† 15+ ä»½è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š

**æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£**:
- TSUP æ„å»ºå·¥å…·é…ç½®
- packages/ui æ„å»ºé…ç½®æ›´æ–°
- TypeScript é…ç½®ä¼˜åŒ–
- Turborepo ä»»åŠ¡ä¾èµ–é…ç½®
- pnpm overrides è§£å†³æ–¹æ¡ˆ
- React Context è·¨æ„å»ºè¾¹ç•Œé—®é¢˜åˆ†æ

**æ¯ä¸ªæ–‡æ¡£è®°å½•äº†**:
- å…·ä½“å®æ–½æ­¥éª¤
- æŠ€æœ¯é…ç½®ç»†èŠ‚
- éªŒè¯æ–¹æ³•å’Œç»“æœ
- å…³é”®æŠ€æœ¯æ´å¯Ÿ

## å…³é”®æŠ€æœ¯æ´å¯Ÿ

### 1. å¤–éƒ¨ä¾èµ–é…ç½®çš„å±€é™æ€§
TSUP external é…ç½®è™½ç„¶æ­£ç¡®ï¼Œä½†åœ¨å¤æ‚ Monorepo ç¯å¢ƒä¸­ä¸è¶³ä»¥è§£å†³ Context é—®é¢˜ã€‚

### 2. ç‰ˆæœ¬ä¸€è‡´æ€§çš„é‡è¦æ€§
ç»†å¾®çš„ç‰ˆæœ¬å·®å¼‚ï¼ˆå¦‚ react ^19.0.0 vs ^19.1.0ï¼‰å°±ä¼šå¯¼è‡´ä¸¥é‡çš„å¤šå®ä¾‹é—®é¢˜ã€‚

### 3. pnpm overrides çš„å¼ºå¤§æ€§
æ˜¯è§£å†³ Monorepo ä¾èµ–å†²çªå’Œ React Context è·¨åŒ…è®¿é—®é—®é¢˜çš„æœ€ä½³å·¥å…·ã€‚

### 4. é‡æ–°å®‰è£…çš„å¿…è¦æ€§
é…ç½®æ›´æ”¹åå¿…é¡»å®Œæ•´é‡æ–°å®‰è£…æ‰èƒ½ç¡®ä¿ overrides è§„åˆ™å®Œå…¨ç”Ÿæ•ˆã€‚

## æœ€ç»ˆæˆæœ

### âœ… æŠ€æœ¯æ¶æ„å®Œæ•´å®ç°
- TSUP æ„å»ºæµç¨‹å®Œç¾è¿è¡Œ
- åŒæ ¼å¼äº§ç‰©ç”Ÿæˆ (ESM + CJS + TypeScript)
- Turborepo ä»»åŠ¡ä¾èµ–æ­£ç¡®é…ç½®
- **ä¾èµ–åŒé‡å®ä¾‹é—®é¢˜å½»åº•è§£å†³**
- **React Context è·¨åŒ…è®¿é—®æˆåŠŸ**

### âœ… æ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡è¾¾æˆ
- åˆ›å»ºåŸºäº Mantine çš„å…±äº« UI åŒ… âœ…
- æˆåŠŸæ¶ˆè´¹ä¸»åº”ç”¨çš„ MantineProvider Context âœ…
- å¯å¤ç”¨ã€ä¸»é¢˜åŒ–çš„ç»„ä»¶æ¶æ„ âœ…
- ç°ä»£åŒ–çš„æ„å»ºå’Œå¼€å‘æµç¨‹ âœ…

### âœ… å¼€å‘ä½“éªŒä¼˜åŒ–
- æ„å»ºé€Ÿåº¦å¿« (TSUP æ„å»º < 1ç§’)
- å¼€å‘çƒ­é‡è½½æ­£å¸¸
- ç±»å‹æ£€æŸ¥å®Œæ•´
- æ— è¿è¡Œæ—¶é”™è¯¯

## æŠ€æœ¯æ–¹æ¡ˆè¯„ä¼°

### æˆåŠŸæ–¹æ¡ˆï¼špnpm overrides
- **ä¼˜åŠ¿**: å½»åº•è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œé…ç½®ç®€å•ï¼Œå½±å“é¢å¯æ§
- **é€‚ç”¨æ€§**: æ˜¯ Monorepo ä¾èµ–å†²çªçš„æ ‡å‡†è§£å†³æ–¹æ¡ˆ
- **ç»´æŠ¤æ€§**: é…ç½®ä¸€æ¬¡ï¼Œé•¿æœŸæœ‰æ•ˆ

### è¢«å°è¯•çš„æ–¹æ¡ˆ
1. **TSUP external é…ç½®**: æ„å»ºæ—¶æ­£ç¡®ï¼Œä½†æ— æ³•è§£å†³è¿è¡Œæ—¶ Context é—®é¢˜
2. **ç‹¬ç«‹ç»„ä»¶æ¶æ„**: æŠ€æœ¯å¯è¡Œä½†è¿èƒŒæ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡

## æ€»ç»“

é€šè¿‡ç³»ç»Ÿæ€§çš„æŠ€æœ¯å®æ–½ï¼ŒæˆåŠŸè§£å†³äº† React Context è·¨åŒ…è®¿é—®è¿™ä¸€å¤æ‚çš„ Monorepo æŠ€æœ¯æŒ‘æˆ˜ï¼š

1. **é—®é¢˜è¯Šæ–­å‡†ç¡®**: å®šä½åˆ°ä¾èµ–åŒé‡å®ä¾‹çš„æ ¹æœ¬åŸå› 
2. **æ–¹æ¡ˆé€‰æ‹©æ­£ç¡®**: pnpm overrides æ˜¯æœ€ä½³æŠ€æœ¯è·¯çº¿
3. **å®æ–½è¿‡ç¨‹ä¸¥è°¨**: å®Œæ•´çš„æ¸…ç†é‡è£…ç¡®ä¿æ•ˆæœ
4. **éªŒè¯ç»“æœå……åˆ†**: å¤šå±‚é¢éªŒè¯ç¡®ä¿é—®é¢˜å½»åº•è§£å†³

è¿™æ¬¡å®æ–½ä¸º damon-stack é¡¹ç›®å»ºç«‹äº†ï¼š
- **ç¨³å›ºçš„æŠ€æœ¯æ¶æ„**: åŸºäºç°ä»£å·¥å…·é“¾çš„ Monorepo æ¶æ„
- **å®Œæ•´çš„å¼€å‘æµç¨‹**: TSUP + Turborepo + pnpm çš„æœ€ä½³å®è·µ
- **è¯¦å°½çš„æŠ€æœ¯æ–‡æ¡£**: 15+ ä»½æ–‡æ¡£è®°å½•æ¯ä¸ªå…³é”®æ­¥éª¤
- **å¯æ‰©å±•çš„åŸºç¡€**: ä¸ºåç»­ç»„ä»¶å¼€å‘å¥ å®šåšå®åŸºç¡€

**æœ€ç»ˆè¯„ä»·**: å®Œå…¨æˆåŠŸçš„æŠ€æœ¯å®æ–½ï¼Œæ‰€æœ‰æ ¸å¿ƒç›®æ ‡å‡å·²è¾¾æˆã€‚ 