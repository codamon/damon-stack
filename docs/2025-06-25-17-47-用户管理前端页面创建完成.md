# ç”¨æˆ·ç®¡ç†å‰ç«¯é¡µé¢åˆ›å»ºå®Œæˆ

**æ—¶é—´**: 2025-06-25 17:47  
**ä»»åŠ¡**: ç”¨æˆ·ç®¡ç†CRUDåŠŸèƒ½æ¨¡å— - ç¬¬å››æ­¥ï¼šåˆ›å»ºå‰ç«¯ UI é¡µé¢

## å®Œæˆå†…å®¹

### 1. ç”¨æˆ·åˆ—è¡¨é¡µé¢ (`/users/page.tsx`)

åˆ›å»ºäº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ä¸»é¡µé¢ï¼ŒåŒ…å«ï¼š

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **ç”¨æˆ·åˆ—è¡¨å±•ç¤º**: è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰ç”¨æˆ·
- âœ… **åˆ›å»ºç”¨æˆ·**: ç‚¹å‡»æŒ‰é’®æ‰“å¼€åˆ›å»ºè¡¨å•
- âœ… **ç¼–è¾‘ç”¨æˆ·**: è¡Œå†…ç¼–è¾‘æŒ‰é’®
- âœ… **åˆ é™¤ç”¨æˆ·**: äºŒæ¬¡ç¡®è®¤åˆ é™¤
- âœ… **æ•°æ®åˆ†é¡µ**: æ”¯æŒåˆ†é¡µåŠ è½½
- âœ… **åŠ è½½çŠ¶æ€**: éª¨æ¶å±åŠ è½½æ•ˆæœ

#### è¡¨æ ¼åˆ—è®¾è®¡
| åˆ—å | å­—æ®µ | å±•ç¤ºæ–¹å¼ | åŠŸèƒ½ |
|------|------|----------|------|
| ID | id | æˆªæ–­æ˜¾ç¤º | ç”¨æˆ·æ ‡è¯† |
| å§“å | name | åŠ ç²—æ˜¾ç¤º | ç”¨æˆ·å§“å |
| é‚®ç®± | email | æ™®é€šæ–‡æœ¬ | è”ç³»æ–¹å¼ |
| è§’è‰² | role | å½©è‰²å¾½ç«  | æƒé™çº§åˆ« |
| çŠ¶æ€ | status | å½©è‰²å¾½ç«  | è´¦æˆ·çŠ¶æ€ |
| åˆ›å»ºæ—¶é—´ | createdAt | æ ¼å¼åŒ–æ—¥æœŸ | æ³¨å†Œæ—¶é—´ |
| æ“ä½œ | - | å›¾æ ‡æŒ‰é’® | ç¼–è¾‘/åˆ é™¤ |

#### çŠ¶æ€ç®¡ç†
```typescript
// Modal æ§åˆ¶
const [formOpened, { open: openForm, close: closeForm }] = useDisclosure(false);
const [deleteOpened, { open: openDelete, close: closeDelete }] = useDisclosure(false);

// ç”¨æˆ·æ•°æ®
const [selectedUser, setSelectedUser] = useState<User | null>(null);
const [userToDelete, setUserToDelete] = useState<User | null>(null);
```

### 2. ç”¨æˆ·è¡¨å•ç»„ä»¶ (`/users/UserForm.tsx`)

åˆ›å»ºäº†æ™ºèƒ½çš„è¡¨å•ç»„ä»¶ï¼Œæ”¯æŒåˆ›å»ºå’Œç¼–è¾‘ï¼š

#### è¡¨å•å­—æ®µ
- **ç”¨æˆ·å**: å¿…å¡«ï¼Œæœ€å¤§100å­—ç¬¦
- **é‚®ç®±**: å¿…å¡«ï¼Œé‚®ç®±æ ¼å¼éªŒè¯
- **è§’è‰²**: ä¸‹æ‹‰é€‰æ‹© (USER/ADMIN)
- **çŠ¶æ€**: ä¸‹æ‹‰é€‰æ‹© (ACTIVE/BANNED)

#### éªŒè¯è§„åˆ™
```typescript
validate: {
  name: (value) => {
    if (!value || value.trim().length === 0) return 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';
    if (value.length > 100) return 'ç”¨æˆ·åä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦';
    return null;
  },
  email: (value) => {
    if (!value || value.trim().length === 0) return 'é‚®ç®±ä¸èƒ½ä¸ºç©º';
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(value)) return 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';
    return null;
  },
  // ... å…¶ä»–éªŒè¯
}
```

#### æ™ºèƒ½æ¨¡å¼åˆ‡æ¢
- **åˆ›å»ºæ¨¡å¼**: ç©ºè¡¨å•ï¼Œè°ƒç”¨ `create` mutation
- **ç¼–è¾‘æ¨¡å¼**: é¢„å¡«æ•°æ®ï¼Œè°ƒç”¨ `update` mutation
- **è‡ªåŠ¨è¯†åˆ«**: æ ¹æ®ä¼ å…¥çš„ `user` prop è‡ªåŠ¨åˆ‡æ¢

### 3. ä¾èµ–ç®¡ç†æ›´æ–°

æ·»åŠ äº†å¿…è¦çš„ Mantine æ‰©å±•åŒ…ï¼š

```json
{
  "@mantine/form": "^8.1.1",
  "@mantine/notifications": "^8.1.1",
  "@tabler/icons-react": "^3.31.0"
}
```

### 4. é€šçŸ¥ç³»ç»Ÿé›†æˆ

æ›´æ–°äº† `app/providers.tsx`ï¼Œæ·»åŠ é€šçŸ¥æ”¯æŒï¼š

```typescript
import { Notifications } from '@mantine/notifications';

export function Providers({ children }: ProvidersProps) {
  return (
    <MantineProvider theme={theme}>
      <Notifications />
      <TRPCReactProvider>
        {children}
      </TRPCReactProvider>
    </MantineProvider>
  );
}
```

## ç”¨æˆ·ä½“éªŒç‰¹æ€§

### 1. è§†è§‰è®¾è®¡
- ğŸ¨ **ç°ä»£åŒ–è¡¨æ ¼**: æ¡çº¹èƒŒæ™¯ã€æ‚¬åœæ•ˆæœ
- ğŸ·ï¸ **å½©è‰²å¾½ç« **: è§’è‰²å’ŒçŠ¶æ€ç›´è§‚åŒºåˆ†
- ğŸ“± **å“åº”å¼å¸ƒå±€**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- âš¡ **å¿«é€Ÿæ“ä½œ**: å›¾æ ‡æŒ‰é’®ä¾¿æ·è®¿é—®

### 2. äº¤äº’ä½“éªŒ
- ğŸ”„ **å®æ—¶åé¦ˆ**: æ“ä½œåç«‹å³æ›´æ–°åˆ—è¡¨
- âš ï¸ **å®‰å…¨ç¡®è®¤**: åˆ é™¤æ“ä½œäºŒæ¬¡ç¡®è®¤
- ğŸ“ **æ™ºèƒ½è¡¨å•**: è‡ªåŠ¨éªŒè¯å’Œé”™è¯¯æç¤º
- ğŸ¯ **ç²¾ç¡®æ“ä½œ**: æ¸…æ™°çš„æ“ä½œæŒ‰é’®

### 3. æ•°æ®å¤„ç†
- ğŸ“Š **åˆ†é¡µåŠ è½½**: é¿å…æ•°æ®è¿‡å¤šå¡é¡¿
- ğŸ” **çŠ¶æ€è¿‡æ»¤**: è§’è‰²å’ŒçŠ¶æ€å¾½ç« è‰²å½©åŒºåˆ†
- ğŸ“… **æ—¶é—´æ ¼å¼**: æœ¬åœ°åŒ–æ—¥æœŸæ—¶é—´æ˜¾ç¤º
- ğŸ†” **IDç®€åŒ–**: é•¿IDæˆªæ–­æ˜¾ç¤º

## æŠ€æœ¯å®ç°äº®ç‚¹

### 1. tRPC é›†æˆ
```typescript
// æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
const { data: usersData, isLoading, refetch } = api.user.list.useQuery({
  limit: 50,
});

// åˆ é™¤ç”¨æˆ·
const deleteMutation = api.user.delete.useMutation({
  onSuccess: () => {
    notifications.show({ title: 'åˆ é™¤æˆåŠŸ', color: 'green' });
    refetch();
  },
});
```

### 2. è¡¨å•ç®¡ç†
```typescript
// Mantine Form é…ç½®
const form = useForm<FormValues>({
  initialValues: { name: '', email: '', role: 'USER', status: 'ACTIVE' },
  validate: { /* éªŒè¯è§„åˆ™ */ },
});

// åŠ¨æ€æ•°æ®å¡«å……
useEffect(() => {
  if (user) {
    form.setValues({
      name: user.name || '',
      email: user.email,
      // ...
    });
  }
}, [user]);
```

### 3. çŠ¶æ€ç®¡ç†
```typescript
// æ¨¡æ€æ¡†æ§åˆ¶
const [formOpened, { open: openForm, close: closeForm }] = useDisclosure(false);

// æ“ä½œçŠ¶æ€
const [selectedUser, setSelectedUser] = useState<User | null>(null);
```

## æ–‡ä»¶ç»“æ„

```
apps/admin-dashboard/app/users/
â”œâ”€â”€ page.tsx          # ç”¨æˆ·åˆ—è¡¨ä¸»é¡µé¢
â””â”€â”€ UserForm.tsx      # ç”¨æˆ·è¡¨å•ç»„ä»¶
```

## è·¯ç”±è®¿é—®

- ğŸ“ **ä¸»é¡µé¢**: `/users`
- ğŸ  **ä»å¯¼èˆª**: Layout ä¾§è¾¹æ  â†’ ç”¨æˆ·ç®¡ç†

## ä¸‹ä¸€æ­¥å¯æ‰©å±•åŠŸèƒ½

è™½ç„¶åŸºæœ¬åŠŸèƒ½å·²å®Œæˆï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ï¼š

- ğŸ” **æœç´¢åŠŸèƒ½**: æŒ‰å§“å/é‚®ç®±æœç´¢
- ğŸ“Š **æ‰¹é‡æ“ä½œ**: æ‰¹é‡åˆ é™¤/ä¿®æ”¹çŠ¶æ€
- ğŸ“ˆ **æ•°æ®ç»Ÿè®¡**: ç”¨æˆ·æ•°é‡ç»Ÿè®¡é¢æ¿
- ğŸ“¤ **æ•°æ®å¯¼å‡º**: å¯¼å‡ºç”¨æˆ·åˆ—è¡¨
- ğŸ”” **æ“ä½œæ—¥å¿—**: è®°å½•ç”¨æˆ·æ“ä½œå†å²

## çŠ¶æ€

âœ… **å®Œæˆ** - ç”¨æˆ·ç®¡ç†å‰ç«¯é¡µé¢å·²åˆ›å»ºï¼Œæ”¯æŒå®Œæ•´çš„CRUDæ“ä½œå’Œç°ä»£åŒ–ç”¨æˆ·ä½“éªŒ 