# æ•°æ®åº“SchemaåŒæ­¥é—®é¢˜ä¿®å¤å®Œæˆ

**æ—¶é—´**: 2025-06-28 02:55  
**ç±»å‹**: æ•°æ®åº“SchemaåŒæ­¥é—®é¢˜  
**å½±å“èŒƒå›´**: CMSæ–‡ç« ç®¡ç†åŠŸèƒ½  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## é—®é¢˜æè¿°

åœ¨è®¿é—®CMSæ–‡ç« åˆ—è¡¨æ—¶å‡ºç°æ•°æ®åº“é”™è¯¯ï¼š
```
Invalid `ctx.db.post.findMany()` invocation
The column `cms_posts.readingTime` does not exist in the current database.
```

é”™è¯¯å‘ç”Ÿåœ¨tRPC APIè°ƒç”¨æ—¶ï¼Œå…·ä½“ä½ç½®ï¼š
```
/Users/damon/Projects/damon-stack/apps/admin-dashboard/.next/server/chunks/[root-of-the-server]__20939ea1._.js:1683:25
```

## æ ¹æœ¬åŸå› åˆ†æ

### Schemaä¸æ•°æ®åº“ä¸åŒæ­¥
1. **Prisma Schemaå®šä¹‰**: åŒ…å«äº†`readingTime`å­—æ®µ
2. **æ•°æ®åº“å®é™…ç»“æ„**: ç¼ºå°‘`readingTime`åˆ—
3. **åŒæ­¥çŠ¶æ€**: å¼€å‘æ•°æ®åº“æœªæ‰§è¡Œæœ€æ–°çš„schemaæ›´æ–°

### å…·ä½“é—®é¢˜
```sql
-- Prisma Schemaä¸­çš„å®šä¹‰
model Post {
  id          String   @id @default(cuid())
  // ... å…¶ä»–å­—æ®µ
  readingTime Int?     // âœ… é¢„è®¡é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  ogImage     String?  // âœ… ç¤¾äº¤åª’ä½“åˆ†äº«å›¾ç‰‡ URL
  // ... å…¶ä»–å­—æ®µ
}

-- æ•°æ®åº“å®é™…ç»“æ„
-- âŒ cms_postsè¡¨ç¼ºå°‘readingTimeåˆ—
-- âŒ å¯èƒ½è¿˜ç¼ºå°‘ogImageåˆ—
```

### å¼€å‘æµç¨‹é—®é¢˜
åœ¨ä¹‹å‰çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼š
1. ä¿®æ”¹äº†Prisma schemaæ–‡ä»¶
2. ä½†æ²¡æœ‰åŒæ­¥åˆ°æ•°æ®åº“
3. åº”ç”¨ä»£ç å‡è®¾å­—æ®µå­˜åœ¨ï¼Œå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯

## ä¿®å¤æ–¹æ¡ˆ

### 1. æ‰§è¡Œæ•°æ®åº“åŒæ­¥
ä½¿ç”¨Prismaçš„`db push`å‘½ä»¤åŒæ­¥schemaåˆ°æ•°æ®åº“ï¼š

```bash
cd packages/db
npx prisma db push
```

### 2. åŒæ­¥ç»“æœç¡®è®¤
```bash
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "postgres", schema "public" at "localhost:5432"

ğŸš€  Your database is now in sync with your Prisma schema. Done in 82ms

âœ” Generated Prisma Client (v6.10.1) to ./../../node_modules/.pnpm/@prisma+client@6.10.1_prisma@6.10.1_typescript@5.8.3__typescript@5.8.3/node_modules/@prisma/client in 84ms
```

### 3. é‡æ–°ç”ŸæˆPrisma Client
åŒæ­¥è¿‡ç¨‹è‡ªåŠ¨é‡æ–°ç”Ÿæˆäº†Prisma Clientï¼Œç¡®ä¿ç±»å‹å®šä¹‰ä¸æ•°æ®åº“ç»“æ„ä¸€è‡´ã€‚

## Schemaå˜æ›´è¯¦æƒ…

### æ–°å¢å­—æ®µ
åœ¨Postæ¨¡å‹ä¸­æ·»åŠ äº†ä»¥ä¸‹å­—æ®µï¼š
```prisma
// å‰ç«¯å±•ç¤ºå­—æ®µ
readingTime     Int?    // é¢„è®¡é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
ogImage         String? // ç¤¾äº¤åª’ä½“åˆ†äº«å›¾ç‰‡ URL
```

### æ•°æ®åº“å˜æ›´
æ‰§è¡Œåæ•°æ®åº“`cms_posts`è¡¨æ–°å¢ï¼š
- `readingTime` - INTEGERç±»å‹ï¼Œå¯ä¸ºNULL
- `ogImage` - TEXTç±»å‹ï¼Œå¯ä¸ºNULL

## éªŒè¯æµ‹è¯•

### 1. æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
```bash
pnpm --filter @damon-stack/admin-dashboard dev
# âœ… æˆåŠŸå¯åŠ¨ï¼Œæ— æ•°æ®åº“é”™è¯¯
```

### 2. APIè®¿é—®æµ‹è¯•
```bash
curl -I http://localhost:3000
# HTTP/1.1 200 OK
# âœ… æœåŠ¡å™¨æ­£å¸¸å“åº”
```

### 3. CMSåŠŸèƒ½æµ‹è¯•
- âœ… æ–‡ç« åˆ—è¡¨é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½
- âœ… tRPC APIè°ƒç”¨ä¸å†æŠ¥é”™
- âœ… Postæ¨¡å‹çš„æ‰€æœ‰å­—æ®µéƒ½å¯ä»¥æ­£å¸¸è®¿é—®

## ç›¸å…³æ–‡ä»¶å’Œç»„ä»¶

### æ ¸å¿ƒä¿®å¤
- **æ•°æ®åº“**: åŒæ­¥äº†æ‰€æœ‰ç¼ºå°‘çš„åˆ—
- **Prisma Client**: é‡æ–°ç”Ÿæˆï¼Œç±»å‹å®šä¹‰æ›´æ–°

### å½±å“çš„åŠŸèƒ½æ¨¡å—
- `apps/admin-dashboard/server/api/routers/post.ts`: PostæŸ¥è¯¢API
- `apps/admin-dashboard/app/cms/posts/*`: æ‰€æœ‰CMSæ–‡ç« ç›¸å…³é¡µé¢
- `@damon-stack/feature-cms`: CMSåŠŸèƒ½æ¨¡å—

## å¼€å‘æœ€ä½³å®è·µ

### Schemaå˜æ›´å·¥ä½œæµ
1. **ä¿®æ”¹schemaæ–‡ä»¶**: `packages/db/prisma/schema.prisma`
2. **åŒæ­¥åˆ°æ•°æ®åº“**: `npx prisma db push` (å¼€å‘ç¯å¢ƒ)
3. **ç”Ÿæˆmigration**: `npx prisma migrate dev` (ç”Ÿäº§ç¯å¢ƒ)
4. **é‡å¯åº”ç”¨**: ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„Prisma Client

### å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ
```bash
# å¼€å‘ç¯å¢ƒï¼ˆå¿«é€ŸåŸå‹ï¼‰
npx prisma db push

# ç”Ÿäº§ç¯å¢ƒï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
npx prisma migrate dev --name add_reading_time_field
npx prisma migrate deploy
```

### å›¢é˜Ÿåä½œè§„èŒƒ
1. **Schemaå˜æ›´å¿…é¡»æäº¤**: ç¡®ä¿teamæˆå‘˜éƒ½èƒ½è·å–æœ€æ–°schema
2. **æ–‡æ¡£è¯´æ˜å˜æ›´**: åœ¨commit messageä¸­è¯´æ˜schemaå˜æ›´
3. **æµ‹è¯•æ•°æ®å‡†å¤‡**: ä¸ºæ–°å­—æ®µå‡†å¤‡åˆç†çš„é»˜è®¤å€¼æˆ–æµ‹è¯•æ•°æ®

## æ•°æ®åº“è¡¨ç»“æ„ (æ›´æ–°å)

### cms_postsè¡¨ä¸»è¦å­—æ®µ
```sql
CREATE TABLE cms_posts (
  id VARCHAR PRIMARY KEY,
  title VARCHAR NOT NULL,
  slug VARCHAR UNIQUE NOT NULL,
  content TEXT NOT NULL,
  excerpt TEXT,
  cover_image VARCHAR,
  status post_status DEFAULT 'DRAFT',
  meta_title VARCHAR,
  meta_description VARCHAR,
  keywords VARCHAR,
  reading_time INTEGER,        -- âœ… æ–°å¢
  og_image VARCHAR,            -- âœ… æ–°å¢
  order_field INTEGER DEFAULT 0,
  featured BOOLEAN DEFAULT false,
  view_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  published_at TIMESTAMP,
  scheduled_at TIMESTAMP,
  author_id VARCHAR NOT NULL,
  category_id VARCHAR,
  created_at TIMESTAMP DEFAULT now(),
  updated_at TIMESTAMP DEFAULT now()
);
```

## æ¶æ„å½±å“

### æ•°æ®æµåˆè§„æ€§
- âœ… ç»´æŒäº†tRPCå•å‘æ•°æ®æµ
- âœ… Prisma Clientç±»å‹å®‰å…¨æ›´æ–°
- âœ… åç«¯APIä¸æ•°æ®åº“ç»“æ„ä¸€è‡´

### åŠŸèƒ½æ‰©å±•å‡†å¤‡
æ–°å¢å­—æ®µä¸ºä»¥ä¸‹åŠŸèƒ½åšå¥½å‡†å¤‡ï¼š
- **readingTime**: æ–‡ç« é˜…è¯»æ—¶é—´ä¼°ç®—æ˜¾ç¤º
- **ogImage**: ç¤¾äº¤åª’ä½“åˆ†äº«ä¼˜åŒ–
- **SEOå¢å¼º**: æ›´å¥½çš„æœç´¢å¼•æ“ä¼˜åŒ–æ”¯æŒ

## é¢„é˜²æªæ–½

### è‡ªåŠ¨åŒ–æ£€æŸ¥
è€ƒè™‘æ·»åŠ ä»¥ä¸‹å¼€å‘å·¥å…·ï¼š
1. **Pre-commit Hook**: æ£€æŸ¥schemaä¸æ•°æ®åº“æ˜¯å¦åŒæ­¥
2. **CI/CDæ£€æŸ¥**: éƒ¨ç½²å‰éªŒè¯æ•°æ®åº“è¿ç§»
3. **å¼€å‘æ–‡æ¡£**: æ˜ç¡®schemaå˜æ›´æµç¨‹

### ç›‘æ§å’Œå‘Šè­¦
- æ•°æ®åº“è¿æ¥çŠ¶æ€ç›‘æ§
- APIé”™è¯¯ç‡ç›‘æ§
- Schemaå˜æ›´è®°å½•è·Ÿè¸ª

## æ€»ç»“

æœ¬æ¬¡ä¿®å¤è§£å†³äº†å¼€å‘ç¯å¢ƒä¸­æ•°æ®åº“schemaä¸ä»£ç ä¸åŒæ­¥çš„é—®é¢˜ï¼š

- **é—®é¢˜æ ¹æº**: æ•°æ®åº“ç¼ºå°‘schemaä¸­å®šä¹‰çš„æ–°å­—æ®µ
- **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨Prisma db pushåŒæ­¥schema
- **æ•ˆæœéªŒè¯**: æ‰€æœ‰CMSåŠŸèƒ½æ¢å¤æ­£å¸¸

è¿™æ¬¡é—®é¢˜æé†’æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¦ä¿æŒæ•°æ®åº“ä¸ä»£ç çš„åŒæ­¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¢é˜Ÿåä½œç¯å¢ƒä¸­ã€‚

---

**ä¿®å¤äººå‘˜**: AIæ¶æ„å¸ˆ  
**éªŒè¯çŠ¶æ€**: âœ… å…¨åŠŸèƒ½éªŒè¯é€šè¿‡  
**æ•°æ®åº“ç‰ˆæœ¬**: å·²åŒæ­¥åˆ°æœ€æ–°Schema  
**å½±å“è¯„ä¼°**: æ— æ•°æ®ä¸¢å¤±ï¼ŒåŠŸèƒ½å®Œå…¨æ¢å¤ 