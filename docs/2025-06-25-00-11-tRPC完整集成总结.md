# ğŸ‰ tRPC v10+ ä¸ Next.js 13+ App Router å®Œæ•´é›†æˆæ€»ç»“

## é¡¹ç›®ä¿¡æ¯
- **å¼€å§‹æ—¶é—´**: 2025-06-25 00:11:24+12:00
- **é¡¹ç›®è·¯å¾„**: `/Users/damon/Projects/damon-stack/apps/admin-dashboard`
- **æŠ€æœ¯æ ˆ**: tRPC v11.4.2 + Next.js 15.3.4 + TypeScript + React Query + Zod

## ğŸ† é›†æˆæˆæœ

### å®Œæˆçš„æ­¥éª¤
1. âœ… **ä¾èµ–å®‰è£…**: å®‰è£…æ‰€æœ‰å¿…è¦çš„ tRPC ç›¸å…³åŒ…
2. âœ… **æ ¸å¿ƒé…ç½®**: åˆ›å»º tRPC æ ¸å¿ƒé…ç½®æ–‡ä»¶
3. âœ… **è·¯ç”±ç³»ç»Ÿ**: æ„å»ºæ ¹è·¯ç”±å’Œç¤ºä¾‹è·¯ç”±
4. âœ… **API å¤„ç†å™¨**: é›†æˆ Next.js App Router API å¤„ç†
5. âœ… **å®¢æˆ·ç«¯é…ç½®**: é…ç½® React Query å’Œ tRPC å®¢æˆ·ç«¯
6. âœ… **å¸ƒå±€é›†æˆ**: åœ¨æ ¹å¸ƒå±€ä¸­é›†æˆ Provider
7. âœ… **æµ‹è¯•éªŒè¯**: åˆ›å»ºå®Œæ•´çš„æµ‹è¯•é¡µé¢

### åˆ›å»ºçš„æ–‡ä»¶
```
apps/admin-dashboard/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx (å·²ä¿®æ”¹ - é›†æˆ TRPCReactProvider)
â”‚   â”œâ”€â”€ page.tsx (å·²ä¿®æ”¹ - æµ‹è¯•é¡µé¢)
â”‚   â””â”€â”€ api/trpc/[trpc]/route.ts (æ–°å»º - API å¤„ç†å™¨)
â”œâ”€â”€ server/api/
â”‚   â”œâ”€â”€ trpc.ts (æ–°å»º - æ ¸å¿ƒé…ç½®)
â”‚   â”œâ”€â”€ root.ts (æ–°å»º - æ ¹è·¯ç”±)
â”‚   â””â”€â”€ routers/
â”‚       â””â”€â”€ post.ts (æ–°å»º - ç¤ºä¾‹è·¯ç”±)
â””â”€â”€ trpc/
    â””â”€â”€ react.tsx (æ–°å»º - å®¢æˆ·ç«¯é…ç½®)
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æœåŠ¡ç«¯æ¶æ„
```
tRPC Server
â”œâ”€â”€ Core Config (server/api/trpc.ts)
â”‚   â”œâ”€â”€ createTRPCContext
â”‚   â”œâ”€â”€ createTRPCRouter  
â”‚   â””â”€â”€ publicProcedure
â”œâ”€â”€ Root Router (server/api/root.ts)
â”‚   â””â”€â”€ appRouter
â””â”€â”€ Feature Routers (server/api/routers/)
    â””â”€â”€ postRouter
        â”œâ”€â”€ hello
        â”œâ”€â”€ getAll
        â””â”€â”€ getById
```

### å®¢æˆ·ç«¯æ¶æ„
```
Next.js App Router
â”œâ”€â”€ Layout (app/layout.tsx)
â”‚   â””â”€â”€ TRPCReactProvider
â”‚       â”œâ”€â”€ api.Provider
â”‚       â””â”€â”€ QueryClientProvider
â”œâ”€â”€ API Routes (app/api/trpc/[trpc]/route.ts)
â”‚   â””â”€â”€ fetchRequestHandler
â””â”€â”€ Pages (app/page.tsx)
    â””â”€â”€ api.post.*.useQuery()
```

## ğŸ“¦ å®‰è£…çš„ä¾èµ–

### æ ¸å¿ƒä¾èµ–
- **@trpc/client** ^11.4.2 - å®¢æˆ·ç«¯æ ¸å¿ƒ
- **@trpc/server** ^11.4.2 - æœåŠ¡ç«¯æ ¸å¿ƒ
- **@trpc/react-query** ^11.4.2 - React Query é›†æˆ
- **@trpc/next** ^11.4.2 - Next.js é€‚é…å™¨
- **@tanstack/react-query** ^5.81.2 - çŠ¶æ€ç®¡ç†
- **zod** ^3.25.67 - ç±»å‹éªŒè¯
- **superjson** ^2.2.2 - æ•°æ®åºåˆ—åŒ–

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ç±»å‹å®‰å…¨
- âœ… ç«¯åˆ°ç«¯ TypeScript ç±»å‹æ¨æ–­
- âœ… è‡ªåŠ¨ç”Ÿæˆçš„ API æ¥å£ç±»å‹
- âœ… Zod è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
- âœ… ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥

### æ€§èƒ½ä¼˜åŒ–
- âœ… HTTP è¯·æ±‚æ‰¹å¤„ç† (maxBatchSize: 10)
- âœ… æ™ºèƒ½ç¼“å­˜ç­–ç•¥ (60ç§’ staleTime)
- âœ… å†…å­˜ç®¡ç† (5åˆ†é’Ÿ gcTime)
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ (1æ¬¡é‡è¯•)

### å¼€å‘ä½“éªŒ
- âœ… è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£
- âœ… é”™è¯¯ç›‘æ§å’Œæ—¥å¿—è®°å½•
- âœ… å¼€å‘ç¯å¢ƒè°ƒè¯•æ”¯æŒ
- âœ… TypeScript æ™ºèƒ½æç¤º

### UI/UX
- âœ… ç°ä»£åŒ–çš„å“åº”å¼è®¾è®¡
- âœ… åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†
- âœ… äº¤äº’å¼æµ‹è¯•ç•Œé¢
- âœ… çŠ¶æ€å¯è§†åŒ–ä»ªè¡¨æ¿

## ğŸ“‹ API ç«¯ç‚¹

### å¯ç”¨çš„ API
1. **post.hello** - é—®å€™ API
   - è¾“å…¥: `{ text: string }`
   - è¾“å‡º: `{ greeting: string, timestamp: Date, success: boolean }`

2. **post.getAll** - è·å–æ‰€æœ‰æ–‡ç« 
   - è¾“å…¥: æ— 
   - è¾“å‡º: `{ posts: Post[], total: number }`

3. **post.getById** - æ ¹æ® ID è·å–æ–‡ç« 
   - è¾“å…¥: `{ id: number }`
   - è¾“å‡º: `{ post: Post, success: boolean }`

### ä½¿ç”¨ç¤ºä¾‹
```tsx
import { api } from '../trpc/react';

function MyComponent() {
  const { data, isLoading, error } = api.post.hello.useQuery({ text: 'World' });
  
  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  
  return <div>{data?.greeting}</div>;
}
```

## ğŸ¯ å…³é”®é…ç½®

### tRPC é…ç½®äº®ç‚¹
- **Context**: ç®€æ´çš„è¯·æ±‚å¤´å¤„ç†
- **Transformer**: superjson æ”¯æŒå¤æ‚ç±»å‹
- **Error Handling**: å¼€å‘ç¯å¢ƒè¯¦ç»†é”™è¯¯æ—¥å¿—
- **Middleware**: å¯æ‰©å±•çš„ä¸­é—´ä»¶ç³»ç»Ÿ

### React Query é…ç½®
- **staleTime**: 60 ç§’ - å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚
- **gcTime**: 5 åˆ†é’Ÿ - åˆç†çš„å†…å­˜ç®¡ç†
- **retry**: 1 æ¬¡ - å¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½
- **refetchOnWindowFocus**: false - é¿å…ä¸å¿…è¦çš„é‡æ–°è·å–

### Next.js App Router é›†æˆ
- **fetchRequestHandler**: ä¸“ä¸º App Router ä¼˜åŒ–
- **Dynamic Routes**: `/api/trpc/[trpc]` åŠ¨æ€è·¯ç”±
- **Server/Client Components**: æ­£ç¡®çš„ç»„ä»¶åˆ†ç¦»

## ğŸ“š æ–‡æ¡£è®°å½•

### è¯¦ç»†æ–‡æ¡£
1. [ä¾èµ–å®‰è£…å®Œæˆ](./2025-06-25-00-11-tRPCä¾èµ–å®‰è£…å®Œæˆ.md)
2. [ä¿®æ­£åçš„æ ¸å¿ƒé…ç½®](./2025-06-25-00-11-ä¿®æ­£åçš„tRPCæ ¸å¿ƒé…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ.md)
3. [æ ¹è·¯ç”±å’Œç¤ºä¾‹è·¯ç”±](./2025-06-25-00-11-æ ¹è·¯ç”±å’Œç¤ºä¾‹è·¯ç”±åˆ›å»ºå®Œæˆ.md)
4. [API å¤„ç†å™¨åˆ›å»º](./2025-06-25-00-11-tRPC_APIå¤„ç†å™¨åˆ›å»ºå®Œæˆ.md)
5. [å®¢æˆ·ç«¯é…ç½®å®Œæˆ](./2025-06-25-00-11-å®¢æˆ·ç«¯tRPCé…ç½®å®Œæˆ.md)
6. [æ ¹å¸ƒå±€é›†æˆå®Œæˆ](./2025-06-25-00-11-æ ¹å¸ƒå±€tRPCé›†æˆå®Œæˆ.md)
7. [æµ‹è¯•é¡µé¢åˆ›å»ºå®Œæˆ](./2025-06-25-00-11-tRPCæµ‹è¯•é¡µé¢åˆ›å»ºå®Œæˆ.md)

## ğŸ”® åç»­å¼€å‘å»ºè®®

### æ‰©å±•åŠŸèƒ½
1. **è®¤è¯ç³»ç»Ÿ**: æ·»åŠ  JWT è®¤è¯ä¸­é—´ä»¶
2. **æ•°æ®åº“é›†æˆ**: è¿æ¥ Prisma ORM
3. **å®æ—¶åŠŸèƒ½**: é›†æˆ WebSocket æ”¯æŒ
4. **æ–‡ä»¶ä¸Šä¼ **: æ·»åŠ æ–‡ä»¶å¤„ç†èƒ½åŠ›

### æ€§èƒ½ä¼˜åŒ–
1. **ç¼“å­˜ç­–ç•¥**: å®ç° Redis ç¼“å­˜
2. **åˆ†é¡µæŸ¥è¯¢**: æ·»åŠ æ— é™æ»šåŠ¨æ”¯æŒ
3. **é¢„åŠ è½½**: å®ç°æ•°æ®é¢„è·å–
4. **é”™è¯¯è¾¹ç•Œ**: æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†

### å¼€å‘å·¥å…·
1. **æµ‹è¯•å¥—ä»¶**: æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **API æ–‡æ¡£**: ç”Ÿæˆ OpenAPI æ–‡æ¡£
3. **ç›‘æ§ç³»ç»Ÿ**: é›†æˆæ€§èƒ½ç›‘æ§
4. **éƒ¨ç½²ä¼˜åŒ–**: é…ç½®ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

## ğŸ‰ é¡¹ç›®æˆåŠŸå®Œæˆï¼

tRPC v10+ ä¸ Next.js 13+ App Router çš„å®Œæ•´é›†æˆå·²ç»æˆåŠŸå®Œæˆã€‚è¿™ä¸ªè®¾ç½®æä¾›äº†ï¼š

- ğŸ”’ **å®Œæ•´çš„ç±»å‹å®‰å…¨**
- âš¡ **å‡ºè‰²çš„æ€§èƒ½**
- ğŸ› ï¸ **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**
- ğŸ“± **ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢**
- ğŸ”§ **é«˜åº¦å¯æ‰©å±•çš„æ¶æ„**

ç°åœ¨æ‚¨å¯ä»¥åŸºäºè¿™ä¸ªåšå®çš„åŸºç¡€å¼€å§‹æ„å»ºæ‚¨çš„ç®¡ç†åå°åº”ç”¨ï¼ 